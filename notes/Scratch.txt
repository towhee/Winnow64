Petteri Focus-Stack

Order:
    FocusStack::run
    FocusStack::start
    FocusStack::schedule_queue_processing

    Load images
    Grayscale
    Align
    ?Focus measure
    Forward-wavelet
    ?Depthmap
    Merge
    Build color reassignment map
    Denoise
    Inverse-wavelet
    Reassign pixel values
    Save


open -a focus-stack --depthmap --3dview --save-steps --verbose
open -a focus-stack -depthmap -3dview -save-steps -verbose
/Users/roryhill/Downloads/focus-stack/focus-stack.app/Contents/MacOS/focus-stack --depthmap=petteridepthmap.png --3dview=petteri3dview.png --save-steps --verbose /Users/roryhill/Projects/Stack/Mouse/*.tif

roryhill@Quark petteri % /Users/roryhill/Downloads/focus-stack/focus-stack.app/Contents/MacOS/focus-stack --depthmap=petteridepthmap.png --3dview=petteri3dview.png --save-steps --verbose /Users/roryhill/Projects/Stack/Mouse/*.tif

CONFIG += sdk_no_version_check

macx:CONFIG += app_bundle

# Must rerun qmake and rebuild when change:
#CONFIG(release, debug|release):DEFINES += QT_NO_DEBUG_OUTPUT
#CONFIG(release, debug|release):DEFINES += QT_NO_WARNING_OUTPUT

#DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000
greaterThan(QT_MAJOR_VERSION, 5) {
    DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x051500
#    win32:QT += core5compat   # huge performance hit without this
}

CONFIG += c++17
win32:QMAKE_CXXFLAGS += /std:c++17
win32:QMAKE_CXXFLAGS += /Zc:__cplusplus
win32:QMAKE_CXXFLAGS += /wd4138             # supress "*/" found outside of comment

TEMPLATE = app
TARGET = Winnow

# Precompiled header setup
# CONFIG += precompile_header
# PRECOMPILED_HEADER = $$PWD/global.h

INCLUDEPATH += $$PWD
INCLUDEPATH += .
INCLUDEPATH += Dialogs
INCLUDEPATH += Utilities
INCLUDEPATH += FocusStack
INCLUDEPATH += FocusStack/Petteri

# Petteri Modular engine
include($$PWD/FocusStack/PetteriModular/petteri_modular.pri)
DISTFILES += FocusStack/PetteriModular/petteri_modular.pri


DEPENDPATH += $$PWD

Release:DESTDIR = release
Release:OBJECTS_DIR = release/.obj
Release:MOC_DIR = release/.moc
Release:RCC_DIR = release/.rcc
Release:UI_DIR = release/.ui

Debug:DESTDIR = debug
Debug:OBJECTS_DIR = debug/.obj
Debug:MOC_DIR = debug/.moc
Debug:RCC_DIR = debug/.rcc
Debug:UI_DIR = debug/.ui

QT += core testlib

QT += widgets
QT += multimedia
QT += multimediawidgets
QT += concurrent









Using legacy Petteri FocusStackWorker
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0229.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0230.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0231.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0232.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0233.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0234.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0235.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0236.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0237.tif"
FocusStackWorker::process "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238.tif"
FocusStack::FocusStack  m_threads = 21
OpenCL device: Apple Apple M1 Ultra OpenCL 1.2
 0.020 [  1/  2] T15 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0233.tif
 0.020 [  2/  7] T14 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0232.tif
 0.020 [  3/ 14] T19 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0234.tif
 0.021 [  4/ 21] T18 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0235.tif
 0.021 [  5/ 22] T6 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0231.tif
 0.021 [  6/ 27] T10 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0230.tif
 0.021 [  7/ 31] T0 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0236.tif
 0.022 [  8/ 37] T9 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0229.tif
 0.022 [  9/ 44] T7 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0237.tif
 0.022 [ 10/ 48] T13 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif
 0.022 [ 11/ 53] T16 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238.tif
 0.022 [ 12/ 59] T20 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif
2025-11-01_0230.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0233.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0234.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0232.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0231.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0235.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0237.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0236.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0229.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0238.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0228.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0227.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
 0.108           T19 Finished task 3 in 0.088 s.
 0.116           T14 Finished task 2 in 0.096 s.
 0.117           T10 Finished task 6 in 0.096 s.
 0.117           T18 Finished task 4 in 0.096 s.
 0.117           T6 Finished task 5 in 0.096 s.
 0.117           T15 Finished task 1 in 0.097 s.
 0.117 [ 13/ 68] T14 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0233.tif
Using grayscale weights R:0.370, G:0.328, B:0.302
 0.124           T7 Finished task 9 in 0.102 s.
 0.125           T9 Finished task 8 in 0.103 s.
 0.126           T13 Finished task 10 in 0.104 s.
 0.126           T16 Finished task 11 in 0.104 s.
 0.126           T20 Finished task 12 in 0.104 s.
 0.127           T0 Finished task 7 in 0.106 s.
 0.155           T14 Finished task 13 in 0.038 s.
 0.155 [ 14/ 68] T9 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0231.tif
 0.155 [ 15/ 68] T18 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0230.tif
 0.155 [ 16/ 68] T1 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0229.tif
 0.155 [ 17/ 68] T14 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0232.tif
 0.155 [ 18/ 68] T17 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0236.tif
 0.155 [ 19/ 68] T4 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif
 0.156 [ 20/ 68] T2 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif
 0.156 [ 21/ 68] T20 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0237.tif
 0.156 [ 22/ 68] T7 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0235.tif
 0.156 [ 23/ 68] T0 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0234.tif
 0.156 [ 24/ 68] T12 Starting task: Align 2025-11-01_0233.tif to 2025-11-01_0233.tif
 0.156 [ 25/ 68] T8 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238.tif
aligned_2025-11-01_0233.tif transformed corners TL (480.0,104.0), TR (5664.0,104.0), BL (480.0,3992.0), BR (5664.0,3992.0)
aligned_2025-11-01_0233.tif valid area X 480, Y 104, W 5184, H 3888
 0.156           T12 Finished task 24 in 0.001 s.
 0.156 [ 26/ 68] T12 Starting task: Grayscale aligned_2025-11-01_0233.tif
 0.225           T9 Finished task 14 in 0.070 s.
 0.229           T18 Finished task 15 in 0.074 s.
 0.229 [ 27/ 68] T9 Starting task: Align 2025-11-01_0230.tif to 2025-11-01_0231.tif
 0.230           T20 Finished task 21 in 0.075 s.
 0.234           T12 Finished task 26 in 0.078 s.
 0.234 [ 28/ 68] T19 Starting task: Forward-wavelet aligned_2025-11-01_0233.tif
 0.235           T1 Finished task 16 in 0.080 s.
 0.235 [ 29/ 68] T1 Starting task: Align 2025-11-01_0229.tif to 2025-11-01_0230.tif
 0.236           T14 Finished task 17 in 0.081 s.
 0.236 [ 30/ 68] T13 Starting task: Align 2025-11-01_0232.tif to 2025-11-01_0233.tif
 0.236 [ 31/ 68] T20 Starting task: Align 2025-11-01_0231.tif to 2025-11-01_0232.tif
 0.239           T0 Finished task 23 in 0.084 s.
 0.239 [ 32/ 68] T11 Starting task: Align 2025-11-01_0234.tif to 2025-11-01_0233.tif
 0.240           T4 Finished task 19 in 0.085 s.
 0.240 [ 33/ 68] T12 Starting task: Align 2025-11-01_0228.tif to 2025-11-01_0229.tif
 0.245           T8 Finished task 25 in 0.089 s.
 0.245 [ 34/ 68] T8 Starting task: Align 2025-11-01_0238.tif to 2025-11-01_0237.tif
 0.246           T17 Finished task 18 in 0.091 s.
 0.246           T7 Finished task 22 in 0.090 s.
 0.246 [ 35/ 68] T7 Starting task: Align 2025-11-01_0235.tif to 2025-11-01_0234.tif
 0.246           T2 Finished task 20 in 0.090 s.
 0.246 [ 36/ 68] T2 Starting task: Align 2025-11-01_0236.tif to 2025-11-01_0235.tif
 0.246 [ 37/ 68] T4 Starting task: Align 2025-11-01_0237.tif to 2025-11-01_0236.tif
 0.246 [ 38/ 68] T0 Starting task: Align 2025-11-01_0227.tif to 2025-11-01_0228.tif
 0.474           T19 Finished task 28 in 0.240 s.
aligned_2025-11-01_0232.tif transform: [0.999 -0.000 5.871; -0.000 0.999 2.435]
aligned_2025-11-01_0232.tif contrast map: C:1.006, X:-0.003, X2:-0.009, Y:-0.002, Y2:-0.002
aligned_2025-11-01_0232.tif whitebalance: R:x0.995+0.0, G:x0.995+0.0, B:x0.993+0.3
aligned_2025-11-01_0234.tif transform: [1.001 0.000 -3.169; -0.000 1.001 -2.405]
aligned_2025-11-01_0234.tif contrast map: C:0.999, X:-0.000, X2:0.003, Y:-0.004, Y2:-0.002
aligned_2025-11-01_0234.tif whitebalance: R:x1.001-0.0, G:x1.001-0.0, B:x1.001-0.0
aligned_2025-11-01_0232.tif transformed corners TL (485.4,106.3), TR (5664.5,105.9), BL (485.4,3990.6), BR (5664.5,3990.1)
aligned_2025-11-01_0232.tif valid area X 486, Y 107, W 5178, H 3883
 1.967           T13 Finished task 30 in 1.731 s.
 1.967 [ 39/ 68] T13 Starting task: Grayscale aligned_2025-11-01_0232.tif
 2.003           T13 Finished task 39 in 0.036 s.
 2.004 [ 40/ 68] T14 Starting task: Forward-wavelet aligned_2025-11-01_0232.tif
aligned_2025-11-01_0231.tif transform: [0.998 0.000 9.522; -0.000 0.998 3.997]
aligned_2025-11-01_0231.tif contrast map: C:1.056, X:0.010, X2:-0.058, Y:-0.016, Y2:0.018
aligned_2025-11-01_0231.tif whitebalance: R:x0.943+0.9, G:x0.950-0.3, B:x0.935+3.4
aligned_2025-11-01_0234.tif transformed corners TL (477.3,101.7), TR (5666.1,101.7), BL (477.8,3993.5), BR (5666.6,3993.5)
aligned_2025-11-01_0234.tif valid area X 480, Y 104, W 5184, H 3888
 2.094           T11 Finished task 32 in 1.855 s.
aligned_2025-11-01_0235.tif transform: [1.002 0.000 -5.350; 0.000 1.002 -3.680]
 2.094 [ 41/ 68] T15 Starting task: Grayscale aligned_2025-11-01_0234.tif
 2.117           T15 Finished task 41 in 0.023 s.
aligned_2025-11-01_0235.tif contrast map: C:0.999, X:-0.002, X2:0.007, Y:-0.005, Y2:-0.011
aligned_2025-11-01_0235.tif whitebalance: R:x1.001-0.0, G:x1.001-0.0, B:x1.001-0.0
aligned_2025-11-01_0231.tif transformed corners TL (488.7,107.7), TR (5663.3,107.0), BL (489.2,3988.5), BR (5663.9,3987.7)
aligned_2025-11-01_0231.tif valid area X 490, Y 108, W 5173, H 3879
 2.200           T20 Finished task 31 in 1.964 s.
aligned_2025-11-01_0230.tif transform: [0.997 0.000 12.453; -0.000 0.997 5.034]
 2.205 [ 42/ 68] T20 Starting task: Grayscale aligned_2025-11-01_0231.tif
aligned_2025-11-01_0230.tif contrast map: C:1.008, X:-0.001, X2:0.010, Y:0.007, Y2:-0.049
aligned_2025-11-01_0230.tif whitebalance: R:x0.996+0.0, G:x0.996+0.0, B:x0.996+0.2
 2.243           T20 Finished task 42 in 0.042 s.
 2.249           T14 Finished task 40 in 0.246 s.
 2.249 [ 43/ 68] T19 Starting task: Forward-wavelet aligned_2025-11-01_0234.tif
aligned_2025-11-01_0235.tif transformed corners TL (475.5,100.5), TR (5668.6,100.7), BL (476.0,3995.5), BR (5669.1,3995.7)
aligned_2025-11-01_0235.tif valid area X 480, Y 104, W 5184, H 3888
 2.287           T7 Finished task 35 in 2.041 s.
aligned_2025-11-01_0236.tif transform: [1.003 0.000 -7.026; 0.000 1.003 -6.141]
 2.287 [ 44/ 68] T7 Starting task: Grayscale aligned_2025-11-01_0235.tif
 2.310           T7 Finished task 44 in 0.023 s.
aligned_2025-11-01_0236.tif contrast map: C:0.995, X:-0.002, X2:0.009, Y:-0.005, Y2:-0.027
aligned_2025-11-01_0236.tif whitebalance: R:x1.005-0.1, G:x1.004-0.1, B:x1.005-0.1
aligned_2025-11-01_0230.tif transformed corners TL (491.1,108.7), TR (5660.9,107.9), BL (491.7,3986.3), BR (5661.4,3985.5)
aligned_2025-11-01_0230.tif valid area X 492, Y 109, W 5168, H 3876
 2.371           T9 Finished task 27 in 2.142 s.
aligned_2025-11-01_0229.tif transform: [0.996 0.000 14.770; -0.000 0.996 6.700]
 2.371 [ 45/ 68] T3 Starting task: Grayscale aligned_2025-11-01_0230.tif
 2.393           T3 Finished task 45 in 0.022 s.
aligned_2025-11-01_0229.tif contrast map: C:1.016, X:0.005, X2:0.016, Y:0.005, Y2:-0.040
aligned_2025-11-01_0229.tif whitebalance: R:x0.988+0.1, G:x0.988+0.1, B:x0.986+0.6
aligned_2025-11-01_0236.tif transformed corners TL (474.2,98.2), TR (5671.9,98.9), BL (474.7,3996.8), BR (5672.3,3997.5)
aligned_2025-11-01_0236.tif valid area X 480, Y 104, W 5184, H 3888
 2.464           T2 Finished task 36 in 2.218 s.
aligned_2025-11-01_0237.tif transform: [1.003 0.000 -10.688; 0.000 1.004 -7.250]
 2.464 [ 46/ 68] T3 Starting task: Grayscale aligned_2025-11-01_0236.tif
 2.470           T19 Finished task 43 in 0.221 s.
 2.470 [ 47/ 68] T19 Starting task: Forward-wavelet aligned_2025-11-01_0231.tif
aligned_2025-11-01_0237.tif contrast map: C:0.993, X:-0.004, X2:0.032, Y:-0.006, Y2:-0.028
aligned_2025-11-01_0237.tif whitebalance: R:x1.007-0.3, G:x1.004+0.2, B:x1.007-0.3
 2.504           T3 Finished task 46 in 0.040 s.
aligned_2025-11-01_0229.tif transformed corners TL (493.0,110.2), TR (5657.7,109.5), BL (493.5,3984.1), BR (5658.1,3983.3)
aligned_2025-11-01_0229.tif valid area X 494, Y 111, W 5163, H 3872
 2.544           T1 Finished task 29 in 2.309 s.
aligned_2025-11-01_0228.tif transform: [0.995 0.000 17.844; -0.000 0.995 7.741]
 2.544 [ 48/ 68] T14 Starting task: Grayscale aligned_2025-11-01_0229.tif
 2.566           T14 Finished task 48 in 0.022 s.
 2.566 [ 49/ 68] T14 Starting task: Build color reassignment map from 8 images
aligned_2025-11-01_0228.tif contrast map: C:1.026, X:0.009, X2:0.032, Y:-0.003, Y2:-0.043
aligned_2025-11-01_0228.tif whitebalance: R:x0.976+1.1, G:x0.980-0.1, B:x0.978+0.1
aligned_2025-11-01_0237.tif transformed corners TL (471.0,97.2), TR (5672.7,97.8), BL (471.4,3998.8), BR (5673.2,3999.4)
aligned_2025-11-01_0237.tif valid area X 480, Y 104, W 5184, H 3888
 2.651           T4 Finished task 37 in 2.405 s.
aligned_2025-11-01_0238.tif transform: [1.004 0.000 -14.559; 0.000 1.004 -8.429]
 2.651 [ 50/ 68] T3 Starting task: Grayscale aligned_2025-11-01_0237.tif
 2.674           T3 Finished task 50 in 0.023 s.
aligned_2025-11-01_0238.tif contrast map: C:1.040, X:0.005, X2:-0.007, Y:-0.019, Y2:0.017
aligned_2025-11-01_0238.tif whitebalance: R:x0.953+0.6, G:x0.959-0.5, B:x0.944+3.2
aligned_2025-11-01_0228.tif transformed corners TL (495.6,111.2), TR (5655.1,111.0), BL (496.3,3981.6), BR (5655.8,3981.4)
aligned_2025-11-01_0228.tif valid area X 497, Y 112, W 5158, H 3869
 2.719           T12 Finished task 33 in 2.479 s.
aligned_2025-11-01_0227.tif transform: [0.994 0.000 16.630; -0.000 0.994 10.235]
 2.719 [ 51/ 68] T3 Starting task: Grayscale aligned_2025-11-01_0228.tif
aligned_2025-11-01_0227.tif contrast map: C:1.015, X:0.014, X2:0.044, Y:0.001, Y2:-0.031
aligned_2025-11-01_0227.tif whitebalance: R:x0.990+0.1, G:x0.990+0.0, B:x0.987+0.5
 2.756           T3 Finished task 51 in 0.037 s.
 2.780           T19 Finished task 47 in 0.310 s.
 2.780 [ 52/ 68] T20 Starting task: Forward-wavelet aligned_2025-11-01_0235.tif
aligned_2025-11-01_0238.tif transformed corners TL (467.5,96.1), TR (5673.7,96.8), BL (468.0,4001.0), BR (5674.2,4001.7)
aligned_2025-11-01_0238.tif valid area X 480, Y 104, W 5184, H 3888
 2.822           T8 Finished task 34 in 2.577 s.
 2.822 [ 53/ 68] T8 Starting task: Grayscale aligned_2025-11-01_0238.tif
 2.847           T8 Finished task 53 in 0.025 s.
aligned_2025-11-01_0227.tif transformed corners TL (493.9,113.6), TR (5648.2,112.6), BL (494.8,3980.2), BR (5649.1,3979.2)
aligned_2025-11-01_0227.tif valid area X 495, Y 114, W 5153, H 3865
 2.896           T0 Finished task 38 in 2.650 s.
 2.897 [ 54/ 68] T0 Starting task: Grayscale aligned_2025-11-01_0227.tif
 2.926           T0 Finished task 54 in 0.029 s.
 2.995           T20 Finished task 52 in 0.215 s.
 2.996 [ 55/ 68] T2 Starting task: Forward-wavelet aligned_2025-11-01_0230.tif
 3.191           T2 Finished task 55 in 0.195 s.
 3.191 [ 56/ 68] T5 Starting task: Forward-wavelet aligned_2025-11-01_0236.tif
 3.388           T5 Finished task 56 in 0.197 s.
 3.388 [ 57/ 68] T6 Starting task: Forward-wavelet aligned_2025-11-01_0229.tif
 3.506           T14 Finished task 49 in 0.940 s.
 3.506 [ 58/ 68] T15 Starting task: Build color reassignment map from 4 images
 3.596           T6 Finished task 57 in 0.208 s.
 3.597 [ 59/ 68] T6 Starting task: Forward-wavelet aligned_2025-11-01_0237.tif
 3.597 [ 60/ 68] T16 Starting task: Merge 8 images
 3.808           T6 Finished task 59 in 0.211 s.
 3.808 [ 61/ 68] T18 Starting task: Forward-wavelet aligned_2025-11-01_0228.tif
 4.019           T18 Finished task 61 in 0.211 s.
 4.019 [ 62/ 68] T8 Starting task: Forward-wavelet aligned_2025-11-01_0238.tif
 4.178           T15 Finished task 58 in 0.672 s.
 4.228           T8 Finished task 62 in 0.209 s.
 4.228 [ 63/ 68] T2 Starting task: Forward-wavelet aligned_2025-11-01_0227.tif
 4.423           T2 Finished task 63 in 0.195 s.
 4.977           T16 Finished task 60 in 1.380 s.
 4.977 [ 64/ 68] T16 Starting task: Merge 4 images
 5.758           T16 Finished task 64 in 0.781 s.
 5.759 [ 65/ 68] T9 Starting task: Denoise merge_result.jpg
 5.913           T9 Finished task 65 in 0.154 s.
 5.913 [ 66/ 68] T9 Starting task: Inverse-wavelet denoised_merge_result.jpg
 6.076           T9 Finished task 66 in 0.163 s.
 6.076 [ 67/ 68] T12 Starting task: Reassign pixel values
 6.476           T12 Finished task 67 in 0.400 s.
 6.477 [ 68/ 68] T7 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238_FocusStack_03.png
/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238_FocusStack_03.png cropped from (6144, 4096) to (5151, 3865)
 7.099           T7 Finished task 68 in 0.622 s.




OpenCL device: Apple Apple M1 Ultra OpenCL 1.2
 0.063 [  1/  7] T14 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0233.tif
 0.064 [  2/ 11] T10 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0232.tif
 0.064 [  3/ 27] T15 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0234.tif
 0.065 [  4/ 32] T19 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0231.tif
 0.066 [  5/ 41] T4 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0235.tif
 0.067 [  6/ 64] T8 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0236.tif
 0.067 [  7/ 64] T7 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0230.tif
 0.067 [  8/ 73] T6 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0229.tif
 0.068 [  9/ 83] T11 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0237.tif
 0.068 [ 10/ 97] T1 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif
 0.068 [ 11/103] T16 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238.tif
 0.069 [ 12/115] T2 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif
2025-11-01_0236.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0230.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0237.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0232.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0238.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0234.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0231.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0229.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0233.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0235.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0227.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0228.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
 0.404           T8 Finished task 6 in 0.337 s.
 0.453           T1 Finished task 10 in 0.385 s.
 0.458           T7 Finished task 7 in 0.392 s.
 0.464           T11 Finished task 9 in 0.396 s.
 0.465           T10 Finished task 2 in 0.401 s.
 0.466           T16 Finished task 11 in 0.398 s.
 0.466           T19 Finished task 4 in 0.401 s.
 0.467           T6 Finished task 8 in 0.400 s.
 0.467           T4 Finished task 5 in 0.401 s.
 0.468           T14 Finished task 1 in 0.405 s.
 0.468           T15 Finished task 3 in 0.404 s.
 0.468 [ 13/134] T20 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0233.tif
Using grayscale weights R:0.370, G:0.328, B:0.302
 0.470           T2 Finished task 12 in 0.401 s.
 0.522           T20 Finished task 13 in 0.054 s.
 0.523 [ 14/134] T13 Starting task: Align 2025-11-01_0233.tif to 2025-11-01_0233.tif
aligned_2025-11-01_0233.tif transformed corners TL (480.0,104.0), TR (5664.0,104.0), BL (480.0,3992.0), BR (5664.0,3992.0)
aligned_2025-11-01_0233.tif valid area X 480, Y 104, W 5184, H 3888
 0.523 [ 15/134] T3 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0232.tif
 0.523 [ 16/134] T20 Starting task: Save aligned_2025-11-01_0233.tif
 0.523 [ 17/134] T11 Starting task: Grayscale aligned_2025-11-01_0233.tif
 0.523 [ 18/134] T8 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0234.tif
 0.523 [ 19/134] T2 Starting task: Save grayscale_2025-11-01_0233.tif
 0.523 [ 20/134] T0 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0231.tif
 0.523 [ 21/134] T15 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0235.tif
 0.523 [ 22/134] T12 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0230.tif
 0.523 [ 23/134] T9 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0236.tif
 0.523           T13 Finished task 14 in 0.000 s.
 0.523 [ 24/134] T13 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0237.tif
 0.523 [ 25/134] T5 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif
 0.523 [ 26/134] T6 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0229.tif
 0.523 [ 27/134] T7 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238.tif
 0.523 [ 28/134] T4 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif
 0.691           T3 Finished task 15 in 0.168 s.
 0.691 [ 29/134] T3 Starting task: Save grayscale_2025-11-01_0232.tif
 0.691 [ 30/134] T17 Starting task: Align 2025-11-01_0232.tif to 2025-11-01_0233.tif
 0.746           T15 Finished task 21 in 0.223 s.
 0.746 [ 31/134] T15 Starting task: Save grayscale_2025-11-01_0235.tif
 0.746 [ 32/134] T16 Starting task: Save grayscale_2025-11-01_0229.tif
 0.746           T6 Finished task 26 in 0.223 s.
 0.748           T11 Finished task 17 in 0.225 s.
 0.748 [ 33/134] T11 Starting task: Forward-wavelet aligned_2025-11-01_0233.tif
 0.748 [ 34/134] T18 Starting task: Focus measure for aligned_2025-11-01_0233.tif
 0.750           T5 Finished task 25 in 0.227 s.
 0.750 [ 35/134] T5 Starting task: Save grayscale_2025-11-01_0238.tif
 0.750           T7 Finished task 27 in 0.227 s.
 0.751 [ 36/134] T7 Starting task: Save grayscale_2025-11-01_0227.tif
 0.757           T0 Finished task 20 in 0.234 s.
 0.757 [ 37/134] T0 Starting task: Save grayscale_2025-11-01_0231.tif
 0.757 [ 38/134] T1 Starting task: Align 2025-11-01_0231.tif to 2025-11-01_0232.tif
 0.758           T9 Finished task 23 in 0.235 s.
 0.758 [ 39/134] T9 Starting task: Save grayscale_2025-11-01_0236.tif
 0.758 [ 40/134] T14 Starting task: Align 2025-11-01_0236.tif to 2025-11-01_0235.tif
 0.758           T12 Finished task 22 in 0.235 s.
 0.758 [ 41/134] T12 Starting task: Save grayscale_2025-11-01_0230.tif
 0.758 [ 42/134] T6 Starting task: Align 2025-11-01_0230.tif to 2025-11-01_0231.tif
 0.758 [ 43/134] T19 Starting task: Align 2025-11-01_0229.tif to 2025-11-01_0230.tif
 0.759           T13 Finished task 24 in 0.236 s.
 0.759 [ 44/134] T13 Starting task: Save grayscale_2025-11-01_0237.tif
 0.759 [ 45/134] T10 Starting task: Align 2025-11-01_0237.tif to 2025-11-01_0236.tif
 0.773           T8 Finished task 18 in 0.250 s.
 0.773 [ 46/134] T8 Starting task: Save grayscale_2025-11-01_0234.tif
 0.775           T4 Finished task 28 in 0.252 s.
 0.775 [ 47/134] T4 Starting task: Align 2025-11-01_0234.tif to 2025-11-01_0233.tif
 0.894           T2 Finished task 19 in 0.371 s.
 0.894 [ 48/134] T2 Starting task: Align 2025-11-01_0235.tif to 2025-11-01_0234.tif
 0.919           T18 Finished task 34 in 0.171 s.
 0.920 [ 49/134] T18 Starting task: Save focusmeasure_aligned_2025-11-01_0233.tif
 1.040           T18 Finished task 49 in 0.120 s.
 1.040 [ 50/134] T18 Starting task: Construct depthmap layer 6
 1.137           T8 Finished task 46 in 0.364 s.
 1.137 [ 51/134] T8 Starting task: Save grayscale_2025-11-01_0228.tif
 1.149           T3 Finished task 29 in 0.458 s.
 1.149 [ 52/134] T3 Starting task: Align 2025-11-01_0228.tif to 2025-11-01_0229.tif
 1.163           T12 Finished task 41 in 0.405 s.
 1.163 [ 53/134] T12 Starting task: Align 2025-11-01_0238.tif to 2025-11-01_0237.tif
 1.171           T9 Finished task 39 in 0.413 s.
 1.171 [ 54/134] T9 Starting task: Align 2025-11-01_0227.tif to 2025-11-01_0228.tif
 1.172           T16 Finished task 32 in 0.426 s.
 1.184           T7 Finished task 36 in 0.433 s.
 1.188           T13 Finished task 44 in 0.429 s.
 1.192           T0 Finished task 37 in 0.435 s.
 1.205           T5 Finished task 35 in 0.455 s.
 1.228           T11 Finished task 33 in 0.480 s.
 1.251           T15 Finished task 31 in 0.505 s.
 1.419           T20 Finished task 16 in 0.896 s.
 1.440           T8 Finished task 51 in 0.303 s.
 1.486           T18 Finished task 50 in 0.446 s.
aligned_2025-11-01_0232.tif transform: [0.999 -0.000 5.903; -0.000 0.999 2.457]
aligned_2025-11-01_0234.tif transform: [1.001 0.000 -3.188; 0.000 1.001 -2.415]
aligned_2025-11-01_0232.tif contrast map: C:1.006, X:-0.001, X2:-0.007, Y:-0.002, Y2:-0.002
aligned_2025-11-01_0232.tif whitebalance: R:x0.995+0.0, G:x0.995+0.0, B:x0.993+0.3
aligned_2025-11-01_0232.tif transformed corners TL (485.4,106.3), TR (5664.5,105.9), BL (485.4,3990.5), BR (5664.5,3990.1)
aligned_2025-11-01_0232.tif valid area X 486, Y 107, W 5178, H 3883
 3.453           T17 Finished task 30 in 2.762 s.
 3.453 [ 55/134] T17 Starting task: Save aligned_2025-11-01_0232.tif
aligned_2025-11-01_0231.tif transform: [0.998 0.000 9.613; -0.000 0.998 4.060]
 3.453 [ 56/134] T8 Starting task: Grayscale aligned_2025-11-01_0232.tif
 3.502           T8 Finished task 56 in 0.049 s.
 3.502 [ 57/134] T8 Starting task: Forward-wavelet aligned_2025-11-01_0232.tif
 3.502 [ 58/134] T0 Starting task: Focus measure for aligned_2025-11-01_0232.tif
 3.617           T0 Finished task 58 in 0.115 s.
 3.617 [ 59/134] T0 Starting task: Save focusmeasure_aligned_2025-11-01_0232.tif
 3.617 [ 60/134] T5 Starting task: Construct depthmap layer 5
 3.668           T0 Finished task 59 in 0.051 s.
aligned_2025-11-01_0234.tif contrast map: C:0.999, X:0.000, X2:0.005, Y:-0.005, Y2:-0.004
aligned_2025-11-01_0234.tif whitebalance: R:x1.001-0.0, G:x1.001-0.0, B:x1.001-0.0
 3.717           T5 Finished task 60 in 0.100 s.
 3.722           T8 Finished task 57 in 0.220 s.
aligned_2025-11-01_0234.tif transformed corners TL (477.3,101.7), TR (5666.1,101.7), BL (477.7,3993.5), BR (5666.6,3993.5)
aligned_2025-11-01_0234.tif valid area X 480, Y 104, W 5184, H 3888
 3.968           T4 Finished task 47 in 3.193 s.
 3.968 [ 61/134] T4 Starting task: Save aligned_2025-11-01_0234.tif
aligned_2025-11-01_0235.tif transform: [1.002 0.000 -5.392; 0.000 1.002 -3.693]
 3.968 [ 62/134] T16 Starting task: Grayscale aligned_2025-11-01_0234.tif
 3.995           T16 Finished task 62 in 0.027 s.
 3.995 [ 63/134] T16 Starting task: Forward-wavelet aligned_2025-11-01_0234.tif
 3.995 [ 64/134] T5 Starting task: Focus measure for aligned_2025-11-01_0234.tif
aligned_2025-11-01_0231.tif contrast map: C:1.056, X:0.011, X2:-0.058, Y:-0.016, Y2:0.020
aligned_2025-11-01_0231.tif whitebalance: R:x0.942+0.9, G:x0.950-0.3, B:x0.934+3.4
 4.079           T5 Finished task 64 in 0.084 s.
 4.079 [ 65/134] T5 Starting task: Save focusmeasure_aligned_2025-11-01_0234.tif
 4.080 [ 66/134] T11 Starting task: Construct depthmap layer 7
 4.141           T5 Finished task 65 in 0.062 s.
 4.156           T16 Finished task 63 in 0.161 s.
 4.175           T11 Finished task 66 in 0.096 s.
 4.278           T17 Finished task 55 in 0.825 s.
aligned_2025-11-01_0231.tif transformed corners TL (488.7,107.8), TR (5663.2,107.1), BL (489.3,3988.4), BR (5663.8,3987.7)
aligned_2025-11-01_0231.tif valid area X 490, Y 108, W 5173, H 3879
 4.328           T1 Finished task 38 in 3.571 s.
 4.328 [ 67/134] T1 Starting task: Save aligned_2025-11-01_0231.tif
aligned_2025-11-01_0230.tif transform: [0.997 0.000 12.567; -0.000 0.997 5.126]
 4.328 [ 68/134] T20 Starting task: Grayscale aligned_2025-11-01_0231.tif
 4.347           T20 Finished task 68 in 0.019 s.
 4.347 [ 69/134] T20 Starting task: Forward-wavelet aligned_2025-11-01_0231.tif
 4.347 [ 70/134] T15 Starting task: Focus measure for aligned_2025-11-01_0231.tif
 4.397           T15 Finished task 70 in 0.050 s.
 4.397 [ 71/134] T15 Starting task: Save focusmeasure_aligned_2025-11-01_0231.tif
 4.397 [ 72/134] T7 Starting task: Construct depthmap layer 4
 4.455           T15 Finished task 71 in 0.058 s.
 4.496           T20 Finished task 69 in 0.149 s.
 4.507           T7 Finished task 72 in 0.110 s.
aligned_2025-11-01_0235.tif contrast map: C:0.999, X:-0.000, X2:0.010, Y:-0.007, Y2:-0.015
aligned_2025-11-01_0235.tif whitebalance: R:x1.001-0.0, G:x1.001-0.0, B:x1.001-0.0
 4.786           T4 Finished task 61 in 0.818 s.
aligned_2025-11-01_0235.tif transformed corners TL (475.5,100.5), TR (5668.7,100.7), BL (476.0,3995.5), BR (5669.1,3995.7)
aligned_2025-11-01_0235.tif valid area X 480, Y 104, W 5184, H 3888
 4.829           T2 Finished task 48 in 3.935 s.
 4.829 [ 73/134] T2 Starting task: Save aligned_2025-11-01_0235.tif
 4.829 [ 74/134] T0 Starting task: Grayscale aligned_2025-11-01_0235.tif
aligned_2025-11-01_0236.tif transform: [1.003 0.000 -7.087; 0.000 1.003 -6.169]
 4.846           T0 Finished task 74 in 0.017 s.
 4.846 [ 75/134] T4 Starting task: Forward-wavelet aligned_2025-11-01_0235.tif
 4.846 [ 76/134] T7 Starting task: Focus measure for aligned_2025-11-01_0235.tif
 4.894           T7 Finished task 76 in 0.048 s.
 4.894 [ 77/134] T7 Starting task: Save focusmeasure_aligned_2025-11-01_0235.tif
 4.894 [ 78/134] T18 Starting task: Construct depthmap layer 8
aligned_2025-11-01_0230.tif contrast map: C:1.008, X:-0.001, X2:0.012, Y:0.008, Y2:-0.045
aligned_2025-11-01_0230.tif whitebalance: R:x0.996+0.1, G:x0.996+0.0, B:x0.996+0.2
 4.965           T7 Finished task 77 in 0.071 s.
 4.985           T4 Finished task 75 in 0.139 s.
 5.005           T18 Finished task 78 in 0.111 s.
 5.165           T1 Finished task 67 in 0.837 s.
aligned_2025-11-01_0230.tif transformed corners TL (491.2,108.8), TR (5660.8,108.0), BL (491.9,3986.2), BR (5661.4,3985.5)
aligned_2025-11-01_0230.tif valid area X 492, Y 109, W 5168, H 3876
 5.193           T6 Finished task 42 in 4.435 s.
aligned_2025-11-01_0229.tif transform: [0.996 0.000 14.930; -0.000 0.996 6.851]
 5.193 [ 79/134] T6 Starting task: Grayscale aligned_2025-11-01_0230.tif
 5.193 [ 80/134] T1 Starting task: Save aligned_2025-11-01_0230.tif
 5.212           T6 Finished task 79 in 0.019 s.
 5.212 [ 81/134] T6 Starting task: Forward-wavelet aligned_2025-11-01_0230.tif
 5.212 [ 82/134] T17 Starting task: Focus measure for aligned_2025-11-01_0230.tif
 5.262           T17 Finished task 82 in 0.050 s.
 5.262 [ 83/134] T17 Starting task: Save focusmeasure_aligned_2025-11-01_0230.tif
 5.262 [ 84/134] T0 Starting task: Construct depthmap layer 3
 5.326           T17 Finished task 83 in 0.064 s.
 5.357           T0 Finished task 84 in 0.095 s.
 5.360           T6 Finished task 81 in 0.148 s.
aligned_2025-11-01_0236.tif contrast map: C:0.995, X:-0.001, X2:0.013, Y:-0.006, Y2:-0.027
aligned_2025-11-01_0236.tif whitebalance: R:x1.005-0.1, G:x1.005-0.1, B:x1.005-0.1
 5.660           T2 Finished task 73 in 0.831 s.
aligned_2025-11-01_0236.tif transformed corners TL (474.2,98.2), TR (5671.9,98.9), BL (474.6,3996.8), BR (5672.4,3997.5)
aligned_2025-11-01_0236.tif valid area X 480, Y 104, W 5184, H 3888
 5.696           T14 Finished task 40 in 4.938 s.
aligned_2025-11-01_0237.tif transform: [1.003 0.000 -10.733; 0.000 1.003 -7.217]
 5.696 [ 85/134] T6 Starting task: Save aligned_2025-11-01_0236.tif
 5.696 [ 86/134] T20 Starting task: Grayscale aligned_2025-11-01_0236.tif
 5.714           T20 Finished task 86 in 0.018 s.
 5.714 [ 87/134] T20 Starting task: Forward-wavelet aligned_2025-11-01_0236.tif
 5.714 [ 88/134] T15 Starting task: Focus measure for aligned_2025-11-01_0236.tif
 5.762           T15 Finished task 88 in 0.048 s.
 5.762 [ 89/134] T15 Starting task: Save focusmeasure_aligned_2025-11-01_0236.tif
 5.762 [ 90/134] T2 Starting task: Construct depthmap layer 9
aligned_2025-11-01_0229.tif contrast map: C:1.016, X:0.005, X2:0.016, Y:0.006, Y2:-0.032
aligned_2025-11-01_0229.tif whitebalance: R:x0.988+0.1, G:x0.988+0.1, B:x0.986+0.6
 5.825           T15 Finished task 89 in 0.063 s.
 5.858           T2 Finished task 90 in 0.096 s.
 5.864           T20 Finished task 87 in 0.150 s.
 6.018           T1 Finished task 80 in 0.825 s.
aligned_2025-11-01_0229.tif transformed corners TL (493.1,110.4), TR (5657.6,109.6), BL (493.6,3984.0), BR (5658.1,3983.2)
aligned_2025-11-01_0229.tif valid area X 494, Y 111, W 5163, H 3872
 6.064           T19 Finished task 43 in 5.306 s.
aligned_2025-11-01_0228.tif transform: [0.995 0.000 18.018; -0.000 0.995 7.947]
 6.064 [ 91/134] T14 Starting task: Save aligned_2025-11-01_0229.tif
 6.064 [ 92/134] T11 Starting task: Grayscale aligned_2025-11-01_0229.tif
 6.081           T11 Finished task 92 in 0.017 s.
 6.081 [ 93/134] T11 Starting task: Focus measure for aligned_2025-11-01_0229.tif
 6.082 [ 94/134] T15 Starting task: Forward-wavelet aligned_2025-11-01_0229.tif
 6.082 [ 95/134] T19 Starting task: Build color reassignment map from 8 images
 6.132           T11 Finished task 93 in 0.051 s.
 6.132 [ 96/134] T11 Starting task: Save focusmeasure_aligned_2025-11-01_0229.tif
 6.132 [ 97/134] T16 Starting task: Construct depthmap layer 2
 6.200           T11 Finished task 96 in 0.068 s.
 6.223           T15 Finished task 94 in 0.141 s.
 6.223 [ 98/134] T15 Starting task: Merge 8 images
 6.228           T16 Finished task 97 in 0.096 s.
aligned_2025-11-01_0237.tif contrast map: C:0.992, X:-0.002, X2:0.037, Y:-0.008, Y2:-0.031
aligned_2025-11-01_0237.tif whitebalance: R:x1.008-0.3, G:x1.005+0.2, B:x1.008-0.3
 6.517           T6 Finished task 85 in 0.821 s.
aligned_2025-11-01_0237.tif transformed corners TL (470.9,97.2), TR (5672.7,97.8), BL (471.4,3998.8), BR (5673.2,3999.4)
aligned_2025-11-01_0237.tif valid area X 480, Y 104, W 5184, H 3888
 6.559           T10 Finished task 45 in 5.800 s.
 6.559 [ 99/134] T10 Starting task: Save aligned_2025-11-01_0237.tif
aligned_2025-11-01_0238.tif transform: [1.004 0.000 -14.583; 0.000 1.004 -8.349]
 6.559 [100/134] T17 Starting task: Grayscale aligned_2025-11-01_0237.tif
 6.586           T17 Finished task 100 in 0.027 s.
 6.586 [101/134] T17 Starting task: Forward-wavelet aligned_2025-11-01_0237.tif
 6.586 [102/134] T7 Starting task: Focus measure for aligned_2025-11-01_0237.tif
 6.644           T7 Finished task 102 in 0.058 s.
 6.644 [103/134] T7 Starting task: Save focusmeasure_aligned_2025-11-01_0237.tif
 6.644 [104/134] T20 Starting task: Construct depthmap layer 10
aligned_2025-11-01_0228.tif contrast map: C:1.026, X:0.009, X2:0.031, Y:-0.002, Y2:-0.035
aligned_2025-11-01_0228.tif whitebalance: R:x0.976+1.1, G:x0.980-0.1, B:x0.978+0.1
 6.702           T7 Finished task 103 in 0.058 s.
 6.811           T20 Finished task 104 in 0.167 s.
 6.887           T17 Finished task 101 in 0.301 s.
 6.893           T14 Finished task 91 in 0.829 s.
aligned_2025-11-01_0228.tif transformed corners TL (495.7,111.4), TR (5655.0,111.2), BL (496.4,3981.5), BR (5655.7,3981.3)
aligned_2025-11-01_0228.tif valid area X 497, Y 112, W 5158, H 3869
 6.939           T3 Finished task 52 in 5.790 s.
aligned_2025-11-01_0227.tif transform: [0.994 0.000 16.846; -0.000 0.994 10.475]
 6.939 [105/134] T6 Starting task: Save aligned_2025-11-01_0228.tif
 6.939 [106/134] T18 Starting task: Grayscale aligned_2025-11-01_0228.tif
 6.958           T18 Finished task 106 in 0.019 s.
 6.958 [107/134] T18 Starting task: Forward-wavelet aligned_2025-11-01_0228.tif
 6.958 [108/134] T14 Starting task: Focus measure for aligned_2025-11-01_0228.tif
 7.063           T14 Finished task 108 in 0.105 s.
 7.063 [109/134] T14 Starting task: Save focusmeasure_aligned_2025-11-01_0228.tif
 7.063 [110/134] T7 Starting task: Construct depthmap layer 1
 7.122           T18 Finished task 107 in 0.164 s.
 7.128           T14 Finished task 109 in 0.065 s.
aligned_2025-11-01_0238.tif contrast map: C:1.040, X:0.006, X2:-0.001, Y:-0.020, Y2:0.014
aligned_2025-11-01_0238.tif whitebalance: R:x0.953+0.7, G:x0.959-0.5, B:x0.944+3.2
 7.181           T7 Finished task 110 in 0.118 s.
aligned_2025-11-01_0238.tif transformed corners TL (467.5,96.2), TR (5673.7,96.9), BL (468.0,4000.9), BR (5674.2,4001.7)
aligned_2025-11-01_0238.tif valid area X 480, Y 104, W 5184, H 3888
 7.424           T12 Finished task 53 in 6.261 s.
 7.424 [111/134] T12 Starting task: Save aligned_2025-11-01_0238.tif
 7.424 [112/134] T7 Starting task: Grayscale aligned_2025-11-01_0238.tif
 7.424           T10 Finished task 99 in 0.865 s.
 7.441           T7 Finished task 112 in 0.017 s.
 7.441 [113/134] T7 Starting task: Forward-wavelet aligned_2025-11-01_0238.tif
 7.441 [114/134] T13 Starting task: Focus measure for aligned_2025-11-01_0238.tif
 7.492           T13 Finished task 114 in 0.051 s.
 7.492 [115/134] T13 Starting task: Save focusmeasure_aligned_2025-11-01_0238.tif
 7.492 [116/134] T14 Starting task: Construct depthmap layer 11
 7.514           T19 Finished task 95 in 1.432 s.
 7.555           T13 Finished task 115 in 0.063 s.
aligned_2025-11-01_0227.tif contrast map: C:1.014, X:0.013, X2:0.042, Y:0.001, Y2:-0.024
aligned_2025-11-01_0227.tif whitebalance: R:x0.990+0.1, G:x0.990+0.0, B:x0.987+0.6
 7.595           T7 Finished task 113 in 0.154 s.
 7.597           T14 Finished task 116 in 0.105 s.
 7.774           T6 Finished task 105 in 0.835 s.
aligned_2025-11-01_0227.tif transformed corners TL (494.1,113.8), TR (5648.1,112.8), BL (495.0,3980.1), BR (5649.0,3979.1)
aligned_2025-11-01_0227.tif valid area X 496, Y 114, W 5152, H 3865
 7.824           T9 Finished task 54 in 6.653 s.
 7.824 [117/134] T20 Starting task: Grayscale aligned_2025-11-01_0227.tif
 7.824 [118/134] T9 Starting task: Save aligned_2025-11-01_0227.tif
 7.844           T20 Finished task 117 in 0.020 s.
 7.844 [119/134] T13 Starting task: Forward-wavelet aligned_2025-11-01_0227.tif
 7.845 [120/134] T2 Starting task: Build color reassignment map from 4 images
 7.845 [121/134] T17 Starting task: Focus measure for aligned_2025-11-01_0227.tif
 7.894           T17 Finished task 121 in 0.050 s.
 7.894 [122/134] T17 Starting task: Save focusmeasure_aligned_2025-11-01_0227.tif
 7.894 [123/134] T4 Starting task: Construct depthmap layer 0
 7.963           T17 Finished task 122 in 0.069 s.
 7.993           T4 Finished task 123 in 0.099 s.
 7.993 [124/134] T4 Starting task: Construct depthmap layer -1
 8.000           T13 Finished task 119 in 0.156 s.
 8.139           T15 Finished task 98 in 1.916 s.
 8.139 [125/134] T7 Starting task: Merge 4 images
 8.267           T12 Finished task 111 in 0.843 s.
 8.638           T9 Finished task 118 in 0.814 s.
 8.678           T2 Finished task 120 in 0.833 s.
 9.279           T7 Finished task 125 in 1.140 s.
 9.280 [126/134] T7 Starting task: Denoise merge_result.jpg
 9.499           T7 Finished task 126 in 0.219 s.
 9.499 [127/134] T7 Starting task: Inverse-wavelet denoised_merge_result.jpg
 9.659           T7 Finished task 127 in 0.160 s.
 9.659 [128/134] T11 Starting task: Save denoised_merge_result.jpg
 9.659 [129/134] T18 Starting task: Reassign pixel values
denoised_merge_result.jpg cropped from (6144, 4096) to (5151, 3865)
 9.927           T11 Finished task 128 in 0.268 s.
10.127           T18 Finished task 129 in 0.468 s.
10.127 [130/134] T1 Starting task: Save output.jpg
output.jpg cropped from (6144, 4096) to (5151, 3865)
10.529           T1 Finished task 130 in 0.402 s.
16.916           T4 Finished task 124 in 8.923 s.
16.916 [131/134] T9 Starting task: Inpaint depthmap
49.835           T9 Finished task 131 in 32.919 s.
49.836 [132/134] T17 Starting task: Save petteridepthmap.png
49.836 [133/134] T16 Starting task: Render 3D preview image
petteridepthmap.png cropped from (6144, 4096) to (5151, 3865)
49.907           T17 Finished task 132 in 0.071 s.
49.997           T16 Finished task 133 in 0.161 s.
49.997 [134/134] T11 Starting task: Save petteri3dview.png
50.546           T11 Finished task 134 in 0.549 s.
Saved to output.jpg
Saved depthmap to petteridepthmap.png
Saved 3D preview to petteri3dview.png






Using FusionPMaxBasic pipeline
"PetteriPipeline::runFull" alignedFolder = "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/"
"PetteriPipeline::runFull" focusFolder   = "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Focus/"
"PetteriPipeline::runFull" depthFolder   = "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Depth/"
FocusStack::FocusStack  m_threads = 21
OpenCL device: Apple Apple M1 Ultra OpenCL 1.2
 0.019 [  1/  1] T17 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0233.tif
 0.019 [  2/  6] T12 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0232.tif
 0.019 [  3/ 13] T2 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0234.tif
 0.020 [  4/ 22] T15 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0231.tif
 0.020 [  5/ 22] T11 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0235.tif
 0.020 [  6/ 33] T6 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0236.tif
 0.020 [  7/ 41] T4 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0229.tif
 0.020 [  8/ 49] T9 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0230.tif
 0.020 [  9/ 49] T1 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0237.tif
 0.020 [ 10/ 49] T3 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif
 0.020 [ 11/ 51] T8 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238.tif
 0.021 [ 12/ 58] T14 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif
2025-11-01_0236.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0234.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0233.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0232.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0235.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0231.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0229.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0228.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0230.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0237.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0238.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
2025-11-01_0227.tif has resolution 5184x3888, using 10 wavelet levels and expanding to 6144x4096
 0.107           T6 Finished task 6 in 0.087 s.
 0.111           T2 Finished task 3 in 0.092 s.
 0.114           T12 Finished task 2 in 0.095 s.
 0.114           T17 Finished task 1 in 0.095 s.
 0.114 [ 13/ 60] T7 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0233.tif
 0.115           T15 Finished task 4 in 0.095 s.
 0.115           T14 Finished task 12 in 0.094 s.
 0.116           T11 Finished task 5 in 0.096 s.
Using grayscale weights R:0.370, G:0.328, B:0.302
 0.121           T3 Finished task 10 in 0.101 s.
 0.123           T9 Finished task 8 in 0.103 s.
 0.123           T1 Finished task 9 in 0.103 s.
 0.123           T4 Finished task 7 in 0.103 s.
 0.123           T8 Finished task 11 in 0.103 s.
 0.151           T7 Finished task 13 in 0.037 s.
 0.151 [ 14/ 60] T18 Starting task: Align 2025-11-01_0233.tif to 2025-11-01_0233.tif
 0.151 [ 15/ 60] T19 Starting task: Save grayscale_2025-11-01_0233.tif
aligned_2025-11-01_0233.tif transformed corners TL (480.0,104.0), TR (5664.0,104.0), BL (480.0,3992.0), BR (5664.0,3992.0)
aligned_2025-11-01_0233.tif valid area X 480, Y 104, W 5184, H 3888
 0.151           T18 Finished task 14 in 0.000 s.
 0.151 [ 16/ 60] T18 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0234.tif
 0.151 [ 17/ 60] T10 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0232.tif
 0.152 [ 18/ 60] T5 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0230.tif
 0.152 [ 19/ 60] T4 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0235.tif
 0.152 [ 20/ 60] T17 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0236.tif
 0.152 [ 21/ 60] T8 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0233.tif
 0.152 [ 22/ 60] T16 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0237.tif
 0.152 [ 23/ 60] T12 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0229.tif
 0.152 [ 24/ 60] T2 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif
 0.152 [ 25/ 60] T7 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238.tif
 0.152 [ 26/ 60] T15 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif
 0.152 [ 27/ 60] T14 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0231.tif
 0.208           T5 Finished task 18 in 0.056 s.
 0.208 [ 28/ 60] T1 Starting task: Save grayscale_2025-11-01_0230.tif
 0.221           T10 Finished task 17 in 0.070 s.
 0.221 [ 29/ 60] T11 Starting task: Save grayscale_2025-11-01_0232.tif
 0.221 [ 30/ 60] T5 Starting task: Align 2025-11-01_0232.tif to 2025-11-01_0233.tif
 0.225           T7 Finished task 25 in 0.073 s.
 0.226 [ 31/ 60] T6 Starting task: Save grayscale_2025-11-01_0238.tif
 0.226           T16 Finished task 22 in 0.074 s.
 0.226 [ 32/ 60] T0 Starting task: Save grayscale_2025-11-01_0237.tif
 0.226 [ 33/ 60] T16 Starting task: Align 2025-11-01_0238.tif to 2025-11-01_0237.tif
 0.228           T4 Finished task 19 in 0.076 s.
 0.228 [ 34/ 60] T4 Starting task: Save grayscale_2025-11-01_0235.tif
 0.228           T12 Finished task 23 in 0.076 s.
 0.228 [ 35/ 60] T7 Starting task: Save grayscale_2025-11-01_0229.tif
 0.228 [ 36/ 60] T10 Starting task: Align 2025-11-01_0229.tif to 2025-11-01_0230.tif
 0.230           T17 Finished task 20 in 0.078 s.
 0.230 [ 37/ 60] T13 Starting task: Save grayscale_2025-11-01_0236.tif
 0.230           T15 Finished task 26 in 0.078 s.
 0.230 [ 38/ 60] T15 Starting task: Align 2025-11-01_0236.tif to 2025-11-01_0235.tif
 0.230 [ 39/ 60] T17 Starting task: Save grayscale_2025-11-01_0234.tif
 0.230 [ 40/ 60] T3 Starting task: Align 2025-11-01_0234.tif to 2025-11-01_0233.tif
 0.230           T18 Finished task 16 in 0.079 s.
 0.230 [ 41/ 60] T9 Starting task: Align 2025-11-01_0235.tif to 2025-11-01_0234.tif
 0.230 [ 42/ 60] T12 Starting task: Align 2025-11-01_0237.tif to 2025-11-01_0236.tif
 0.230 [ 43/ 60] T18 Starting task: Save grayscale_2025-11-01_0227.tif
 0.233           T2 Finished task 24 in 0.081 s.
 0.233 [ 44/ 60] T2 Starting task: Save grayscale_2025-11-01_0228.tif
 0.234           T14 Finished task 27 in 0.083 s.
 0.235 [ 45/ 60] T14 Starting task: Save grayscale_2025-11-01_0231.tif
 0.470           T19 Finished task 15 in 0.319 s.
 0.470 [ 46/ 60] T19 Starting task: Align 2025-11-01_0231.tif to 2025-11-01_0232.tif
 0.545           T4 Finished task 34 in 0.317 s.
 0.545 [ 47/ 60] T4 Starting task: Align 2025-11-01_0230.tif to 2025-11-01_0231.tif
 0.546           T0 Finished task 32 in 0.320 s.
 0.546 [ 48/ 60] T0 Starting task: Align 2025-11-01_0228.tif to 2025-11-01_0229.tif
 0.553           T7 Finished task 35 in 0.325 s.
 0.553 [ 49/ 60] T7 Starting task: Align 2025-11-01_0227.tif to 2025-11-01_0228.tif
 0.554           T1 Finished task 28 in 0.346 s.
 0.555           T11 Finished task 29 in 0.334 s.
 0.556           T2 Finished task 44 in 0.323 s.
 0.559           T13 Finished task 37 in 0.329 s.
 0.566           T17 Finished task 39 in 0.336 s.
 0.566           T14 Finished task 45 in 0.331 s.
 0.567           T18 Finished task 43 in 0.337 s.
 0.568           T6 Finished task 31 in 0.343 s.
 0.943           T8 Finished task 21 in 0.792 s.
aligned_2025-11-01_0234.tif transform: [1.001 0.000 -3.169; -0.000 1.001 -2.405]
aligned_2025-11-01_0232.tif transform: [0.999 -0.000 5.871; -0.000 0.999 2.435]
aligned_2025-11-01_0234.tif contrast map: C:0.999, X:-0.000, X2:0.003, Y:-0.004, Y2:-0.002
aligned_2025-11-01_0234.tif whitebalance: R:x1.001-0.0, G:x1.001-0.0, B:x1.001-0.0
aligned_2025-11-01_0232.tif contrast map: C:1.006, X:-0.003, X2:-0.009, Y:-0.002, Y2:-0.002
aligned_2025-11-01_0232.tif whitebalance: R:x0.995+0.0, G:x0.995+0.0, B:x0.993+0.3
aligned_2025-11-01_0234.tif transformed corners TL (477.3,101.7), TR (5666.1,101.7), BL (477.8,3993.5), BR (5666.6,3993.5)
aligned_2025-11-01_0234.tif valid area X 480, Y 104, W 5184, H 3888
 2.460           T3 Finished task 40 in 2.230 s.
 2.460 [ 50/ 60] T3 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0234.tif
aligned_2025-11-01_0235.tif transform: [1.002 0.000 -5.350; 0.000 1.002 -3.680]
aligned_2025-11-01_0235.tif contrast map: C:0.999, X:-0.002, X2:0.007, Y:-0.005, Y2:-0.011
aligned_2025-11-01_0235.tif whitebalance: R:x1.001-0.0, G:x1.001-0.0, B:x1.001-0.0
aligned_2025-11-01_0232.tif transformed corners TL (485.4,106.3), TR (5664.5,105.9), BL (485.4,3990.6), BR (5664.5,3990.1)
aligned_2025-11-01_0232.tif valid area X 486, Y 107, W 5178, H 3883
 2.560           T5 Finished task 30 in 2.339 s.
 2.560 [ 51/ 60] T5 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0232.tif
aligned_2025-11-01_0231.tif transform: [0.998 0.000 9.522; -0.000 0.998 3.997]
aligned_2025-11-01_0231.tif contrast map: C:1.056, X:0.010, X2:-0.058, Y:-0.016, Y2:0.018
aligned_2025-11-01_0231.tif whitebalance: R:x0.943+0.9, G:x0.950-0.3, B:x0.935+3.4
aligned_2025-11-01_0235.tif transformed corners TL (475.5,100.5), TR (5668.6,100.7), BL (476.0,3995.5), BR (5669.1,3995.7)
aligned_2025-11-01_0235.tif valid area X 480, Y 104, W 5184, H 3888
 2.643           T9 Finished task 41 in 2.413 s.
aligned_2025-11-01_0236.tif transform: [1.003 0.000 -7.026; 0.000 1.003 -6.141]
 2.643 [ 52/ 60] T9 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0235.tif
aligned_2025-11-01_0236.tif contrast map: C:0.995, X:-0.002, X2:0.009, Y:-0.005, Y2:-0.027
aligned_2025-11-01_0236.tif whitebalance: R:x1.005-0.1, G:x1.004-0.1, B:x1.005-0.1
aligned_2025-11-01_0231.tif transformed corners TL (488.7,107.7), TR (5663.3,107.0), BL (489.2,3988.5), BR (5663.9,3987.7)
aligned_2025-11-01_0231.tif valid area X 490, Y 108, W 5173, H 3879
 2.729           T19 Finished task 46 in 2.259 s.
 2.729 [ 53/ 60] T19 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0231.tif
aligned_2025-11-01_0230.tif transform: [0.997 0.000 12.453; -0.000 0.997 5.034]
aligned_2025-11-01_0230.tif contrast map: C:1.008, X:-0.001, X2:0.010, Y:0.007, Y2:-0.049
aligned_2025-11-01_0230.tif whitebalance: R:x0.996+0.0, G:x0.996+0.0, B:x0.996+0.2
aligned_2025-11-01_0236.tif transformed corners TL (474.2,98.2), TR (5671.9,98.9), BL (474.7,3996.8), BR (5672.3,3997.5)
aligned_2025-11-01_0236.tif valid area X 480, Y 104, W 5184, H 3888
 2.809           T15 Finished task 38 in 2.579 s.
 2.809 [ 54/ 60] T15 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0236.tif
aligned_2025-11-01_0237.tif transform: [1.003 0.000 -10.688; 0.000 1.004 -7.250]
aligned_2025-11-01_0237.tif contrast map: C:0.993, X:-0.004, X2:0.032, Y:-0.006, Y2:-0.028
aligned_2025-11-01_0237.tif whitebalance: R:x1.007-0.3, G:x1.004+0.2, B:x1.007-0.3
aligned_2025-11-01_0230.tif transformed corners TL (491.1,108.7), TR (5660.9,107.9), BL (491.7,3986.3), BR (5661.4,3985.5)
aligned_2025-11-01_0230.tif valid area X 492, Y 109, W 5168, H 3876
 2.895           T4 Finished task 47 in 2.350 s.
aligned_2025-11-01_0229.tif transform: [0.996 0.000 14.770; -0.000 0.996 6.700]
 2.895 [ 55/ 60] T4 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0230.tif
aligned_2025-11-01_0229.tif contrast map: C:1.016, X:0.005, X2:0.016, Y:0.005, Y2:-0.040
aligned_2025-11-01_0229.tif whitebalance: R:x0.988+0.1, G:x0.988+0.1, B:x0.986+0.6
aligned_2025-11-01_0237.tif transformed corners TL (471.0,97.2), TR (5672.7,97.8), BL (471.4,3998.8), BR (5673.2,3999.4)
aligned_2025-11-01_0237.tif valid area X 480, Y 104, W 5184, H 3888
 2.980           T12 Finished task 42 in 2.750 s.
 2.980 [ 56/ 60] T12 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0237.tif
aligned_2025-11-01_0238.tif transform: [1.004 0.000 -14.559; 0.000 1.004 -8.429]
aligned_2025-11-01_0238.tif contrast map: C:1.040, X:0.005, X2:-0.007, Y:-0.019, Y2:0.017
aligned_2025-11-01_0238.tif whitebalance: R:x0.953+0.6, G:x0.959-0.5, B:x0.944+3.2
aligned_2025-11-01_0229.tif transformed corners TL (493.0,110.2), TR (5657.7,109.5), BL (493.5,3984.1), BR (5658.1,3983.3)
aligned_2025-11-01_0229.tif valid area X 494, Y 111, W 5163, H 3872
 3.062           T10 Finished task 36 in 2.834 s.
aligned_2025-11-01_0228.tif transform: [0.995 0.000 17.844; -0.000 0.995 7.741]
 3.063 [ 57/ 60] T13 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0229.tif
aligned_2025-11-01_0228.tif contrast map: C:1.026, X:0.009, X2:0.032, Y:-0.003, Y2:-0.043
aligned_2025-11-01_0228.tif whitebalance: R:x0.976+1.1, G:x0.980-0.1, B:x0.978+0.1
aligned_2025-11-01_0238.tif transformed corners TL (467.5,96.1), TR (5673.7,96.8), BL (468.0,4001.0), BR (5674.2,4001.7)
aligned_2025-11-01_0238.tif valid area X 480, Y 104, W 5184, H 3888
 3.155           T16 Finished task 33 in 2.929 s.
 3.155 [ 58/ 60] T6 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0238.tif
aligned_2025-11-01_0228.tif transformed corners TL (495.6,111.2), TR (5655.1,111.0), BL (496.3,3981.6), BR (5655.8,3981.4)
aligned_2025-11-01_0228.tif valid area X 497, Y 112, W 5158, H 3869
 3.236           T0 Finished task 48 in 2.690 s.
aligned_2025-11-01_0227.tif transform: [0.994 0.000 16.630; -0.000 0.994 10.235]
 3.236 [ 59/ 60] T14 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0228.tif
aligned_2025-11-01_0227.tif contrast map: C:1.015, X:0.014, X2:0.044, Y:0.001, Y2:-0.031
aligned_2025-11-01_0227.tif whitebalance: R:x0.990+0.1, G:x0.990+0.0, B:x0.987+0.5
 3.325           T3 Finished task 50 in 0.865 s.
 3.392           T5 Finished task 51 in 0.832 s.
aligned_2025-11-01_0227.tif transformed corners TL (493.9,113.6), TR (5648.2,112.6), BL (494.8,3980.2), BR (5649.1,3979.2)
aligned_2025-11-01_0227.tif valid area X 495, Y 114, W 5153, H 3865
 3.412           T7 Finished task 49 in 2.859 s.
 3.412 [ 60/ 60] T7 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0227.tif
 3.506           T9 Finished task 52 in 0.863 s.
 3.582           T19 Finished task 53 in 0.853 s.
 3.640           T15 Finished task 54 in 0.831 s.
 3.711           T4 Finished task 55 in 0.816 s.
 3.791           T12 Finished task 56 in 0.811 s.
 3.873           T13 Finished task 57 in 0.810 s.
 3.926           T6 Finished task 58 in 0.771 s.
 3.999           T14 Finished task 59 in 0.763 s.
 4.120           T7 Finished task 60 in 0.708 s.
PetteriAlign::run: Alignment completed successfully.
FocusStack::FocusStack  m_threads = 21
OpenCL device: Apple Apple M1 Ultra OpenCL 1.2
 0.000 [  1/  1] T16 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0233.tif
 0.000 [  2/ 10] T0 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0232.tif
 0.001 [  3/ 16] T14 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0234.tif
 0.001 [  4/ 31] T5 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0231.tif
 0.001 [  5/ 31] T18 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0235.tif
 0.001 [  6/ 37] T2 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0230.tif
 0.001 [  7/ 43] T10 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0236.tif
 0.002 [  8/ 50] T19 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0229.tif
 0.002 [  9/ 60] T7 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0237.tif
 0.002 [ 10/ 66] T11 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0228.tif
 0.002 [ 11/ 83] T13 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0227.tif
 0.002 [ 12/ 83] T15 Starting task: Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0238.tif
2025-11-01_0233.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.247           T16 Finished task 1 in 0.247 s.
 0.247 [ 13/ 92] T6 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0233.tif
2025-11-01_0234.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.247           T14 Finished task 3 in 0.246 s.
Using grayscale weights R:0.370, G:0.328, B:0.302
2025-11-01_0232.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.248           T0 Finished task 2 in 0.248 s.
2025-11-01_0235.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.248           T18 Finished task 5 in 0.247 s.
2025-11-01_0237.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.250           T7 Finished task 9 in 0.248 s.
2025-11-01_0236.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.253           T10 Finished task 7 in 0.252 s.
2025-11-01_0230.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.253           T2 Finished task 6 in 0.252 s.
2025-11-01_0227.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.254           T13 Finished task 11 in 0.252 s.
2025-11-01_0229.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.255           T19 Finished task 8 in 0.253 s.
2025-11-01_0238.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.256           T15 Finished task 12 in 0.254 s.
2025-11-01_0231.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.257           T5 Finished task 4 in 0.256 s.
2025-11-01_0228.tif has resolution 6144x4096, using 10 wavelet levels and expanding to 6144x4096
 0.258           T11 Finished task 10 in 0.256 s.
 0.279           T6 Finished task 13 in 0.032 s.
 0.279 [ 14/ 92] T16 Starting task: Align 2025-11-01_0233.tif to 2025-11-01_0233.tif
aligned_2025-11-01_0233.tif transformed corners TL (0.0,0.0), TR (6144.0,0.0), BL (0.0,4096.0), BR (6144.0,4096.0)
aligned_2025-11-01_0233.tif valid area X 0, Y 0, W 6144, H 4096
 0.279 [ 15/ 92] T0 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0232.tif
 0.279 [ 16/ 92] T8 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0231.tif
 0.279 [ 17/ 92] T11 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0234.tif
 0.280 [ 18/ 92] T14 Starting task: Grayscale aligned_2025-11-01_0233.tif
 0.280 [ 19/ 92] T2 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0230.tif
 0.280           T16 Finished task 14 in 0.001 s.
 0.280 [ 20/ 92] T4 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0235.tif
 0.280 [ 21/ 92] T6 Starting task: Save grayscale_2025-11-01_0233.tif
 0.280 [ 22/ 92] T17 Starting task: Save aligned_2025-11-01_0233.tif
 0.280 [ 23/ 92] T5 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0236.tif
 0.280 [ 24/ 92] T10 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0229.tif
 0.280 [ 25/ 92] T18 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0237.tif
 0.280 [ 26/ 92] T15 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0238.tif
 0.280 [ 27/ 92] T12 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0228.tif
 0.280 [ 28/ 92] T19 Starting task: Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned//2025-11-01_0227.tif
 0.344           T8 Finished task 16 in 0.065 s.
 0.344 [ 29/ 92] T1 Starting task: Save grayscale_2025-11-01_0231.tif
 0.351           T11 Finished task 17 in 0.072 s.
 0.351 [ 30/ 92] T7 Starting task: Save grayscale_2025-11-01_0234.tif
 0.351 [ 31/ 92] T9 Starting task: Align 2025-11-01_0234.tif to 2025-11-01_0233.tif
 0.354           T0 Finished task 15 in 0.075 s.
 0.354 [ 32/ 92] T16 Starting task: Save grayscale_2025-11-01_0232.tif
 0.354 [ 33/ 92] T0 Starting task: Align 2025-11-01_0232.tif to 2025-11-01_0233.tif
 0.354 [ 34/ 92] T3 Starting task: Align 2025-11-01_0231.tif to 2025-11-01_0232.tif
 0.358           T4 Finished task 20 in 0.079 s.
 0.358 [ 35/ 92] T11 Starting task: Save grayscale_2025-11-01_0235.tif
 0.358 [ 36/ 92] T13 Starting task: Align 2025-11-01_0235.tif to 2025-11-01_0234.tif
 0.359           T14 Finished task 18 in 0.079 s.
 0.359 [ 37/ 92] T14 Starting task: Forward-wavelet aligned_2025-11-01_0233.tif
 0.366           T5 Finished task 23 in 0.086 s.
 0.366 [ 38/ 92] T4 Starting task: Save grayscale_2025-11-01_0236.tif
 0.366 [ 39/ 92] T5 Starting task: Align 2025-11-01_0236.tif to 2025-11-01_0235.tif
 0.372           T19 Finished task 28 in 0.092 s.
 0.372 [ 40/ 92] T19 Starting task: Save grayscale_2025-11-01_0227.tif
 0.373           T15 Finished task 26 in 0.093 s.
 0.373 [ 41/ 92] T15 Starting task: Save grayscale_2025-11-01_0238.tif
 0.374           T2 Finished task 19 in 0.094 s.
 0.375 [ 42/ 92] T2 Starting task: Save grayscale_2025-11-01_0230.tif
 0.375 [ 43/ 92] T8 Starting task: Align 2025-11-01_0230.tif to 2025-11-01_0231.tif
 0.376           T10 Finished task 24 in 0.096 s.
 0.376 [ 44/ 92] T10 Starting task: Save grayscale_2025-11-01_0229.tif
 0.376           T12 Finished task 27 in 0.096 s.
 0.377 [ 45/ 92] T12 Starting task: Align 2025-11-01_0229.tif to 2025-11-01_0230.tif
 0.377           T18 Finished task 25 in 0.097 s.
 0.377 [ 46/ 92] T18 Starting task: Save grayscale_2025-11-01_0237.tif
 0.642           T6 Finished task 21 in 0.363 s.
 0.642 [ 47/ 92] T6 Starting task: Align 2025-11-01_0237.tif to 2025-11-01_0236.tif
 0.698           T16 Finished task 32 in 0.344 s.
 0.698 [ 48/ 92] T16 Starting task: Save grayscale_2025-11-01_0228.tif
 0.705           T14 Finished task 37 in 0.346 s.
 0.705 [ 49/ 92] T14 Starting task: Align 2025-11-01_0228.tif to 2025-11-01_0229.tif
 0.706           T19 Finished task 40 in 0.334 s.
 0.706 [ 50/ 92] T19 Starting task: Align 2025-11-01_0238.tif to 2025-11-01_0237.tif
 0.711           T15 Finished task 41 in 0.338 s.
 0.711 [ 51/ 92] T15 Starting task: Align 2025-11-01_0227.tif to 2025-11-01_0228.tif
 0.713           T2 Finished task 42 in 0.338 s.
 0.714           T7 Finished task 30 in 0.363 s.
 0.717           T1 Finished task 29 in 0.373 s.
 0.719           T10 Finished task 44 in 0.343 s.
 0.725           T11 Finished task 35 in 0.367 s.
 0.731           T18 Finished task 46 in 0.354 s.
 0.736           T4 Finished task 38 in 0.370 s.
 0.945           T16 Finished task 48 in 0.247 s.
 1.091           T17 Finished task 22 in 0.811 s.
aligned_2025-11-01_0232.tif transform: [1.000 -0.000 -0.208; -0.000 1.000 -0.336]
aligned_2025-11-01_0234.tif transform: [1.000 -0.000 0.272; 0.000 1.000 0.355]
aligned_2025-11-01_0232.tif contrast map: C:1.001, X:0.000, X2:-0.009, Y:0.002, Y2:0.000
aligned_2025-11-01_0232.tif whitebalance: R:x0.999+0.0, G:x0.999+0.0, B:x1.000-0.0
aligned_2025-11-01_0232.tif transformed corners TL (-0.2,-0.3), TR (6144.2,-0.5), BL (-0.3,4096.6), BR (6144.2,4096.4)
aligned_2025-11-01_0232.tif valid area X 0, Y 0, W 6144, H 4096
 2.015           T0 Finished task 33 in 1.661 s.
aligned_2025-11-01_0231.tif transform: [1.000 0.000 -0.566; -0.000 1.000 -0.656]
 2.015 [ 52/ 92] T10 Starting task: Grayscale aligned_2025-11-01_0232.tif
 2.024 [ 53/ 92] T11 Starting task: Save aligned_2025-11-01_0232.tif
 2.041           T10 Finished task 52 in 0.026 s.
 2.042 [ 54/ 92] T4 Starting task: Forward-wavelet aligned_2025-11-01_0232.tif
aligned_2025-11-01_0231.tif contrast map: C:1.004, X:-0.004, X2:-0.025, Y:0.008, Y2:-0.011
aligned_2025-11-01_0231.tif whitebalance: R:x0.997-0.0, G:x0.997-0.0, B:x0.998-0.0
aligned_2025-11-01_0231.tif transformed corners TL (-0.6,-0.7), TR (6144.5,-1.2), BL (-0.6,4097.4), BR (6144.5,4096.8)
aligned_2025-11-01_0231.tif valid area X 0, Y 0, W 6144, H 4096
 2.185           T3 Finished task 34 in 1.831 s.
aligned_2025-11-01_0230.tif transform: [1.000 0.000 -0.959; -0.000 1.001 -0.996]
 2.185 [ 55/ 92] T3 Starting task: Save aligned_2025-11-01_0231.tif
 2.185 [ 56/ 92] T17 Starting task: Grayscale aligned_2025-11-01_0231.tif
 2.217           T17 Finished task 56 in 0.032 s.
aligned_2025-11-01_0230.tif contrast map: C:0.997, X:-0.003, X2:-0.002, Y:0.006, Y2:0.015
aligned_2025-11-01_0230.tif whitebalance: R:x1.001-0.1, G:x1.001+0.0, B:x1.001-0.2
 2.293           T4 Finished task 54 in 0.251 s.
 2.293 [ 57/ 92] T4 Starting task: Forward-wavelet aligned_2025-11-01_0231.tif
aligned_2025-11-01_0230.tif transformed corners TL (-1.0,-1.0), TR (6145.0,-1.6), BL (-0.9,4097.9), BR (6145.0,4097.3)
aligned_2025-11-01_0230.tif valid area X 0, Y 0, W 6144, H 4096
 2.358           T8 Finished task 43 in 1.983 s.
 2.358 [ 58/ 92] T8 Starting task: Save aligned_2025-11-01_0230.tif
aligned_2025-11-01_0229.tif transform: [1.000 0.000 -1.342; -0.000 1.001 -1.389]
 2.358 [ 59/ 92] T17 Starting task: Grayscale aligned_2025-11-01_0230.tif
aligned_2025-11-01_0234.tif contrast map: C:1.002, X:0.001, X2:0.002, Y:-0.002, Y2:-0.012
aligned_2025-11-01_0234.tif whitebalance: R:x1.000+0.0, G:x1.000+0.0, B:x1.000+0.0
 2.375           T17 Finished task 59 in 0.017 s.
aligned_2025-11-01_0234.tif transformed corners TL (0.3,0.4), TR (6143.7,0.5), BL (0.3,4095.4), BR (6143.7,4095.5)
aligned_2025-11-01_0234.tif valid area X 1, Y 1, W 6142, H 4094
 2.491           T9 Finished task 31 in 2.140 s.
 2.491 [ 60/ 92] T7 Starting task: Save aligned_2025-11-01_0234.tif
aligned_2025-11-01_0235.tif transform: [1.000 -0.000 0.704; 0.000 0.999 0.753]
 2.491 [ 61/ 92] T0 Starting task: Grayscale aligned_2025-11-01_0234.tif
 2.495           T4 Finished task 57 in 0.202 s.
 2.495 [ 62/ 92] T10 Starting task: Forward-wavelet aligned_2025-11-01_0230.tif
 2.509           T0 Finished task 61 in 0.018 s.
 2.696           T10 Finished task 62 in 0.201 s.
 2.696 [ 63/ 92] T10 Starting task: Forward-wavelet aligned_2025-11-01_0234.tif
 2.798           T11 Finished task 53 in 0.783 s.
aligned_2025-11-01_0229.tif contrast map: C:0.996, X:-0.005, X2:-0.004, Y:0.008, Y2:0.020
aligned_2025-11-01_0229.tif whitebalance: R:x1.001-0.1, G:x1.001-0.0, B:x1.001-0.2
 2.891           T10 Finished task 63 in 0.195 s.
aligned_2025-11-01_0235.tif contrast map: C:1.003, X:0.000, X2:-0.001, Y:-0.005, Y2:-0.018
aligned_2025-11-01_0235.tif whitebalance: R:x0.999+0.0, G:x0.999+0.0, B:x0.998+0.0
aligned_2025-11-01_0229.tif transformed corners TL (-1.3,-1.4), TR (6145.4,-2.0), BL (-1.3,4098.4), BR (6145.4,4097.8)
aligned_2025-11-01_0229.tif valid area X 0, Y 0, W 6144, H 4096
 2.950           T12 Finished task 45 in 2.573 s.
aligned_2025-11-01_0228.tif transform: [1.001 -0.000 -1.847; -0.000 1.001 -1.764]
 2.950 [ 64/ 92] T12 Starting task: Save aligned_2025-11-01_0229.tif
 2.950 [ 65/ 92] T17 Starting task: Grayscale aligned_2025-11-01_0229.tif
 2.968           T17 Finished task 65 in 0.018 s.
 2.972 [ 66/ 92] T10 Starting task: Forward-wavelet aligned_2025-11-01_0229.tif
aligned_2025-11-01_0228.tif contrast map: C:0.997, X:-0.003, X2:-0.012, Y:0.010, Y2:0.024
aligned_2025-11-01_0228.tif whitebalance: R:x1.000-0.1, G:x1.000-0.0, B:x1.000-0.2
 2.990           T3 Finished task 55 in 0.805 s.
aligned_2025-11-01_0235.tif transformed corners TL (0.7,0.8), TR (6143.3,1.0), BL (0.7,4094.7), BR (6143.3,4094.9)
aligned_2025-11-01_0235.tif valid area X 1, Y 1, W 6142, H 4093
 3.090           T13 Finished task 36 in 2.732 s.
aligned_2025-11-01_0236.tif transform: [1.000 -0.000 1.067; 0.000 0.999 1.139]
 3.090 [ 67/ 92] T1 Starting task: Grayscale aligned_2025-11-01_0235.tif
 3.096 [ 68/ 92] T9 Starting task: Save aligned_2025-11-01_0235.tif
 3.110           T1 Finished task 67 in 0.020 s.
aligned_2025-11-01_0236.tif contrast map: C:1.004, X:-0.001, X2:-0.000, Y:-0.007, Y2:-0.016
aligned_2025-11-01_0236.tif whitebalance: R:x0.998+0.0, G:x0.999+0.0, B:x0.999+0.0
aligned_2025-11-01_0228.tif transformed corners TL (-1.8,-1.8), TR (6145.9,-2.4), BL (-1.9,4098.8), BR (6145.9,4098.2)
aligned_2025-11-01_0228.tif valid area X 0, Y 0, W 6144, H 4096
 3.136           T14 Finished task 49 in 2.431 s.
aligned_2025-11-01_0227.tif transform: [1.001 0.000 -2.276; -0.000 1.001 -2.187]
 3.136 [ 69/ 92] T17 Starting task: Grayscale aligned_2025-11-01_0228.tif
 3.142 [ 70/ 92] T2 Starting task: Save aligned_2025-11-01_0228.tif
 3.163           T17 Finished task 69 in 0.027 s.
aligned_2025-11-01_0227.tif contrast map: C:0.993, X:-0.005, X2:0.011, Y:0.011, Y2:0.035
aligned_2025-11-01_0227.tif whitebalance: R:x1.003-0.1, G:x1.003-0.1, B:x1.003-0.2
 3.188           T8 Finished task 58 in 0.830 s.
 3.215           T10 Finished task 66 in 0.243 s.
 3.215 [ 71/ 92] T8 Starting task: Forward-wavelet aligned_2025-11-01_0235.tif
aligned_2025-11-01_0236.tif transformed corners TL (1.1,1.1), TR (6143.0,1.3), BL (0.9,4094.2), BR (6142.9,4094.3)
aligned_2025-11-01_0236.tif valid area X 2, Y 2, W 6140, H 4092
 3.280           T5 Finished task 39 in 2.914 s.
aligned_2025-11-01_0237.tif transform: [1.000 -0.000 1.442; 0.000 0.999 1.478]
 3.280 [ 72/ 92] T1 Starting task: Grayscale aligned_2025-11-01_0236.tif
 3.281 [ 73/ 92] T10 Starting task: Save aligned_2025-11-01_0236.tif
 3.314           T7 Finished task 60 in 0.823 s.
aligned_2025-11-01_0237.tif contrast map: C:1.006, X:0.000, X2:-0.009, Y:-0.006, Y2:-0.025
aligned_2025-11-01_0237.tif whitebalance: R:x0.997+0.1, G:x0.998+0.1, B:x0.997+0.0
aligned_2025-11-01_0227.tif transformed corners TL (-2.3,-2.2), TR (6146.3,-2.6), BL (-2.2,4099.1), BR (6146.4,4098.7)
aligned_2025-11-01_0227.tif valid area X 0, Y 0, W 6144, H 4096
 3.326           T1 Finished task 72 in 0.046 s.
 3.326 [ 74/ 92] T18 Starting task: Build color reassignment map from 8 images
 3.326           T15 Finished task 51 in 2.615 s.
 3.326 [ 75/ 92] T3 Starting task: Save aligned_2025-11-01_0227.tif
 3.326 [ 76/ 92] T11 Starting task: Grayscale aligned_2025-11-01_0227.tif
 3.354           T11 Finished task 76 in 0.028 s.
 3.442           T8 Finished task 71 in 0.227 s.
 3.442 [ 77/ 92] T17 Starting task: Forward-wavelet aligned_2025-11-01_0236.tif
aligned_2025-11-01_0237.tif transformed corners TL (1.4,1.5), TR (6142.5,1.7), BL (1.3,4093.6), BR (6142.4,4093.7)
aligned_2025-11-01_0237.tif valid area X 2, Y 2, W 6140, H 4091
 3.453           T6 Finished task 47 in 2.811 s.
aligned_2025-11-01_0238.tif transform: [0.999 -0.000 2.005; 0.000 0.999 1.786]
 3.453 [ 78/ 92] T16 Starting task: Save aligned_2025-11-01_0237.tif
 3.453 [ 79/ 92] T11 Starting task: Grayscale aligned_2025-11-01_0237.tif
 3.483           T11 Finished task 79 in 0.030 s.
aligned_2025-11-01_0238.tif contrast map: C:1.008, X:0.005, X2:-0.021, Y:-0.003, Y2:-0.052
aligned_2025-11-01_0238.tif whitebalance: R:x0.996+0.0, G:x0.997+0.1, B:x0.998+0.0
aligned_2025-11-01_0238.tif transformed corners TL (2.0,1.8), TR (6142.0,2.1), BL (1.8,4092.9), BR (6141.8,4093.2)
aligned_2025-11-01_0238.tif valid area X 3, Y 3, W 6138, H 4089
 3.628           T19 Finished task 50 in 2.922 s.
 3.628 [ 80/ 92] T19 Starting task: Save aligned_2025-11-01_0238.tif
 3.628 [ 81/ 92] T14 Starting task: Grayscale aligned_2025-11-01_0238.tif
 3.654           T14 Finished task 81 in 0.026 s.
 3.656           T17 Finished task 77 in 0.214 s.
 3.656 [ 82/ 92] T17 Starting task: Merge 8 images
 3.656 [ 83/ 92] T4 Starting task: Forward-wavelet aligned_2025-11-01_0237.tif
 3.867           T12 Finished task 64 in 0.917 s.
 3.914           T4 Finished task 83 in 0.258 s.
 3.915 [ 84/ 92] T7 Starting task: Forward-wavelet aligned_2025-11-01_0228.tif
 3.993           T9 Finished task 68 in 0.903 s.
 4.004           T2 Finished task 70 in 0.868 s.
 4.136           T7 Finished task 84 in 0.221 s.
 4.137 [ 85/ 92] T7 Starting task: Forward-wavelet aligned_2025-11-01_0238.tif
 4.164           T10 Finished task 73 in 0.884 s.
 4.192           T3 Finished task 75 in 0.866 s.
 4.285           T18 Finished task 74 in 0.959 s.
 4.285 [ 86/ 92] T18 Starting task: Build color reassignment map from 4 images
 4.320           T16 Finished task 78 in 0.867 s.
 4.393           T7 Finished task 85 in 0.256 s.
 4.393 [ 87/ 92] T12 Starting task: Forward-wavelet aligned_2025-11-01_0227.tif
 4.466           T19 Finished task 80 in 0.838 s.
 4.675           T12 Finished task 87 in 0.282 s.
 4.763           T17 Finished task 82 in 1.107 s.
 4.763 [ 88/ 92] T17 Starting task: Merge 4 images
 5.001           T18 Finished task 86 in 0.716 s.
 5.168           T17 Finished task 88 in 0.405 s.
 5.168 [ 89/ 92] T18 Starting task: Inverse-wavelet merge_result.jpg
 5.339           T18 Finished task 89 in 0.171 s.
 5.339 [ 90/ 92] T17 Starting task: Save merge_result.jpg
 5.339 [ 91/ 92] T0 Starting task: Reassign pixel values
 5.405           T17 Finished task 90 in 0.066 s.
 5.781           T0 Finished task 91 in 0.442 s.
 5.781 [ 92/ 92] T0 Starting task: Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Focus/


Task Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Focus/ on thread 0 failed with exception:
OpenCV(4.11.0) /tmp/opencv-20250209-52406-1dh1o3/opencv-4.11.0/modules/imgcodecs/src/loadsave.cpp:836: error: (-2:Unspecified error) could not find a writer for the specified extension in function 'imwrite_'

PetteriFocusMaps::run: Petteri run() returned failure.
PetteriPipeline::runFull: Focus-map stage failed.





Tiff::read Failed to read headers. "/Users/roryhill/Projects/Stack/Mouse/2025-11-01_0238/FusionPMaxBasic/Aligned/2025-11-01_0236.tif"



Legacy Petteri:
Worker::add  task =  m_total_tasks = 1 "Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 2 "Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 3 "Align 2025-11-01_0228.tif to 2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 4 "Grayscale aligned_2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 5 "Forward-wavelet aligned_2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 6 "Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif"
Worker::add  task =  m_total_tasks = 7 "Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif"
Worker::add  task =  m_total_tasks = 8 "Align 2025-11-01_0227.tif to 2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 9 "Grayscale aligned_2025-11-01_0227.tif"
Worker::add  task =  m_total_tasks = 10 "Forward-wavelet aligned_2025-11-01_0227.tif"
Worker::add  task =  m_total_tasks = 11 "Merge 2 images"
Worker::add  task =  m_total_tasks = 12 "Build color reassignment map from 2 images"
Worker::add  task =  m_total_tasks = 13 "Denoise merge_result.jpg"
Worker::add  task =  m_total_tasks = 14 "Inverse-wavelet denoised_merge_result.jpg"
Worker::add  task =  m_total_tasks = 15 "Reassign pixel values"
Worker::add  task =  m_total_tasks = 16 "Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228_FocusStack.png"
Using FusionPMaxBasic pipeline
Worker::add  task =  m_total_tasks = 1 "Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 2 "Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 3 "Save grayscale_2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 4 "Align 2025-11-01_0228.tif to 2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 5 "Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228/FusionPMaxBasic/Aligned/2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 6 "Load /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif"
Worker::add  task =  m_total_tasks = 7 "Grayscale /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0227.tif"
Worker::add  task =  m_total_tasks = 8 "Save grayscale_2025-11-01_0227.tif"
Worker::add  task =  m_total_tasks = 9 "Align 2025-11-01_0227.tif to 2025-11-01_0228.tif"
Worker::add  task =  m_total_tasks = 10 "Save /Users/roryhill/Projects/Stack/Mouse/2025-11-01_0228/FusionPMaxBasic/Aligned/2025-11-01_0227.tif"


Winnow64/FocusStack/

    Petteri/
        Original Petteri files (no changes)

    PetteriModular/
        Modified Petteri files for modular implementations (new namespace?)
        Core/                 task engine & worker
        Tasks/                Task_Align, Task_LoadImg, Task_Merge, etc
        IO/                   TIFF/PNG/EXR load/save
        Wrappers/             new modular wrappers (we write these)

    Modules/                  modular implementation using Petteri as backend
        Align/
            PetteriAlign.h/.cpp
            ECCAlign.h/.cpp             optional future alignment
            NoOpAlign.h/.cpp            for already-aligned inputs

        Focus/
            PetteriFocusMaps.h/.cpp
            GradientFocusMaps.h/.cpp    future alternative method
            MLFocusMaps.h/.cpp          future ML-based method

        Depth/
            PetteriDepthMap.h/.cpp
            ContrastDepthMap.h/.cpp
            MLDepthMap.h/.cpp

        Fusion/
            PetteriPMaxFusion.h/.cpp
            PetteriWaveFusion.h/.cpp
            WeightedPMax.h/.cpp         your variant
            DepthAwareFusion.h/.cpp     hybrid depth method
            MLMaskFusion.h/.cpp         segmentation-first method

    Pipeline/
        PipelineBase.h/.cpp
        PipelinePMax.h/.cpp             calls modules in order
        PipelineWavePMax.h/.cpp
        PipelineDepthAware.h/.cpp
        PipelineLegacyPetteri.h/.cpp    wraps original Petteri::run()

    Mask/
        maskoptions.h/.cpp
        maskgenerator.h/.cpp
        maskrefiner.h/.cpp
        maskassessor.h/.cpp


Before we start replacing petteri calls with modular equivalents let's confirm the current situation in FocusStack:

1.   I can commented out all the Winnow64.pro sources referring to FocusStack/Petteri such as
# SOURCES += FocusStack/Petteri/3dpreview.cpp
# SOURCES += FocusStack/Petteri/align.cpp
# SOURCES += FocusStack/Petteri/background_removal.cpp
etc
so they do not conflict with the FocusStack/Petteri versions that are defined in petteri_modular.pri.

2.  I have removed all prior classes and files used to abstract align, measure, depthmap and fuse, since they relied on using the original petteri code, not the PetteriModular versions, which we will be adapting to provide modular access.

I've identified which parts of the new FocusStack structure have files at present:

Winnow64/FocusStack/

    Petteri/
        (untouched original sources) Files = yes

    PetteriModular/
        Core/
        Tasks/
        IO/
        Wrappers/
        Namespace: petteri_mod

    Contracts/
        IAlign.h   File = yes
        IFocus.h
        IDepth.h
        IFusion.h

    Stages/
        Align/
            PetteriAlign.h/.cpp
            ECCAlign.h/.cpp
            NoOpAlign.h/.cpp
        Fusion/
            PetteriPMaxFusion.h/.cpp
            WeightedPMax.h/.cpp
            DepthAwareFusion.h/.cpp
        Depth/
            PetteriDepthMap.h/.cpp
            ContrastDepthMap.h/.cpp
        Focus/
            PetteriFocusMaps.h/.cpp
            GradientFocusMaps.h/.cpp

    Pipeline/
        PipelineBase.h/.cpp
        PipelinePMax.h/.cpp
        PipelineWavePMax.h/.cpp
        PipelineDepthAware.h/.cpp
        PipelineLegacyPetteri.h/.cpp

    Mask/
        maskoptions.h/.cpp
        maskgenerator.h/.cpp
        maskrefiner.h/.cpp
        maskassessor.h/.cpp

    Utils/
        pyramid.h/.cpp
        blend.h/.cpp
        filehelpers.h/.cpp

    Cache/
        PyramidCache.h/.cpp
        ImageCache.h/.cpp


# Winnow64.pro
CONFIG += sdk_no_version_check

macx:CONFIG += app_bundle
# Must rerun qmake and rebuild when change:
#CONFIG(release, debug|release):DEFINES += QT_NO_DEBUG_OUTPUT
#CONFIG(release, debug|release):DEFINES += QT_NO_WARNING_OUTPUT


#DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000
greaterThan(QT_MAJOR_VERSION, 5) {
    DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x051500
#    win32:QT += core5compat   # huge performance hit without this
}

CONFIG += c++17
win32:QMAKE_CXXFLAGS += /std:c++17
win32:QMAKE_CXXFLAGS += /Zc:__cplusplus
win32:QMAKE_CXXFLAGS += /wd4138             # supress "*/" found outside of comment

TEMPLATE = app
TARGET = Winnow

# Precompiled header setup
# CONFIG += precompile_header
# PRECOMPILED_HEADER = $$PWD/global.h

INCLUDEPATH += $$PWD
INCLUDEPATH += .
INCLUDEPATH += Dialogs
INCLUDEPATH += Utilities
INCLUDEPATH += FocusStack
# INCLUDEPATH += FocusStack/Petteri
INCLUDEPATH += FocusStack/PetteriModule

# Petteri Modular engine
include($$PWD/FocusStack/PetteriModular/petteri_modular.pri)
DISTFILES += FocusStack/PetteriModular/petteri_modular.pri


DEPENDPATH += $$PWD

Release:DESTDIR = release
Release:OBJECTS_DIR = release/.obj
Release:MOC_DIR = release/.moc
Release:RCC_DIR = release/.rcc
Release:UI_DIR = release/.ui

Debug:DESTDIR = debug
Debug:OBJECTS_DIR = debug/.obj
Debug:MOC_DIR = debug/.moc
Debug:RCC_DIR = debug/.rcc
Debug:UI_DIR = debug/.ui

QT += core testlib

QT += widgets
QT += multimedia
QT += multimediawidgets
QT += concurrent



PetteriModular/Core/
PetteriModular/Pipeline/
PetteriModular/IO/
PetteriModular/Fusion/
PetteriModular/Options/
PetteriModular/Denoise/
PetteriModular/Wave/

















CONFIG += sdk_no_version_check

macx:CONFIG += app_bundle

# Must rerun qmake and rebuild when change:
#CONFIG(release, debug|release):DEFINES += QT_NO_DEBUG_OUTPUT
#CONFIG(release, debug|release):DEFINES += QT_NO_WARNING_OUTPUT

#DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000
greaterThan(QT_MAJOR_VERSION, 5) {
    DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x051500
#    win32:QT += core5compat   # huge performance hit without this
}

# QMAKE_BUNDLE_IDENTIFIER = com.winnow.Winnow

# Compile without warnings
# GCC / Clang
# QMAKE_CXXFLAGS += -Wno-unused-variable
# QMAKE_CFLAGS += -Wno-unused-variable
# MSVC
# pragma warning(disable: 4101) # 4101 is the warning number for unused variable in MSVC

#QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.13

# Compile on MacOS without permission prompts:
# - Add Build Step > Custom Process Step
# - Command: chmod
# - Arguments: +x /path/to.winnow.exe

# MacOS universal binaries
# QMAKE_APPLE_DEVICE_ARCHS = arm64
# QMAKE_APPLE_DEVICE_ARCHS = x86_64 arm64

CONFIG += c++17
win32:QMAKE_CXXFLAGS += /std:c++17
win32:QMAKE_CXXFLAGS += /Zc:__cplusplus
win32:QMAKE_CXXFLAGS += /wd4138             # supress "*/" found outside of comment

TEMPLATE = app
TARGET = Winnow

# Precompiled header setup
# CONFIG += precompile_header
# PRECOMPILED_HEADER = $$PWD/global.h

INCLUDEPATH += $$PWD
INCLUDEPATH += .
INCLUDEPATH += Dialogs
INCLUDEPATH += Utilities
INCLUDEPATH += FocusStack
INCLUDEPATH += FocusStack/Petteri

# Petteri Modular engine
# include($$PWD/FocusStack/PetteriModular/petteri_modular.pri)
# DISTFILES += FocusStack/PetteriModular/petteri_modular.pri


DEPENDPATH += $$PWD

Release:DESTDIR = release
Release:OBJECTS_DIR = release/.obj
Release:MOC_DIR = release/.moc
Release:RCC_DIR = release/.rcc
Release:UI_DIR = release/.ui

Debug:DESTDIR = debug
Debug:OBJECTS_DIR = debug/.obj
Debug:MOC_DIR = debug/.moc
Debug:RCC_DIR = debug/.rcc
Debug:UI_DIR = debug/.ui

QT += core testlib

QT += widgets
QT += multimedia
QT += multimediawidgets
QT += concurrent

HEADERS += Cache/cachedata.h \
    FocusStack/Contracts/IAlign.h \
    FocusStack/Contracts/IDepth.h \
    FocusStack/Contracts/IFocus.h \
    FocusStack/Contracts/IFusion.h \
    FocusStack/Contracts/IStage.h \
    FocusStack/PetteriAdapter/petterialignfuse.h
HEADERS += Cache/tiffthumbdecoder.h
HEADERS += ImageFormats/Video/mov.h
HEADERS += ImageFormats/Video/mp4.h
HEADERS += ImageFormats/Png/png.h
HEADERS += Cache/framedecoder.h
HEADERS += Cache/imagecache.h
HEADERS += Cache/imagedecoder.h
HEADERS += Cache/metaread.h
HEADERS += Cache/reader.h
HEADERS += Datamodel/buildfilters.h
HEADERS += Datamodel/datamodel.h
HEADERS += Datamodel/filters.h
HEADERS += Datamodel/selection.h
HEADERS += Dialogs/aboutdlg.h
HEADERS += Dialogs/addthumbnailsdlg.h
HEADERS += Dialogs/appdlg.h
HEADERS += Dialogs/copystyledlg.h
HEADERS += Dialogs/editlistdlg.h
HEADERS += Dialogs/erasememcardimagesdlg.h
HEADERS += Dialogs/findduplicatesdlg.h
HEADERS += Dialogs/imagedlg.h
HEADERS += Dialogs/ingestdlg.h
HEADERS += Dialogs/ingesterrors.h
HEADERS += Dialogs/loadusbdlg.h
HEADERS += Dialogs/loupeinfodlg.h
HEADERS += Dialogs/managegraphicsdlg.h
HEADERS += Dialogs/manageimagesdlg.h
HEADERS += Dialogs/managetilesdlg.h
HEADERS += Dialogs/patterndlg.h
HEADERS += Dialogs/preferencesdlg.h
HEADERS += Dialogs/renamedlg.h
HEADERS += Dialogs/saveasdlg.h
HEADERS += Dialogs/selectionorpicksdlg.h
HEADERS += Dialogs/testaligndlg.h
HEADERS += Dialogs/tokendlg.h
HEADERS += Dialogs/updateapp.h
HEADERS += Dialogs/workspacedlg.h
HEADERS += Dialogs/zoomdlg.h
HEADERS += Effects/effects.h
HEADERS += Effects/graphicseffect.h
HEADERS += Embellish/embel.h
HEADERS += Effects/graphicsitemeventfilter.h
HEADERS += Effects/interpolate.h
HEADERS += Effects/REF_imageblitz_effects.h
HEADERS += Embellish/embelexport.h
HEADERS += Embellish/Properties/embelproperties.h
HEADERS += File/bookmarks.h
HEADERS += File/fstree.h
HEADERS += File/hoverdelegate.h
HEADERS += File/ingest.h
HEADERS += FocusStack/Fusion/fusionbase.h
HEADERS += FocusStack/Fusion/fusionfactory.h
HEADERS += FocusStack/Fusion/fusionpmaxbasic.h
HEADERS += FocusStack/Fusion/fusionwavepmax.h
HEADERS += FocusStack/Mask/maskassessor.h
HEADERS += FocusStack/Mask/maskgenerator.h
HEADERS += FocusStack/Mask/maskoptions.h
HEADERS += FocusStack/Mask/maskrefiner.h
HEADERS += FocusStack/PetteriAdapter/petterialign.h
HEADERS += FocusStack/PetteriAdapter/petteridepthmap.h
HEADERS += FocusStack/PetteriAdapter/petterifocusmaps.h
HEADERS += FocusStack/PetteriAdapter/petteripipeline.h
HEADERS += FocusStack/PetteriAdapter/petteripmaxfusion.h
HEADERS += FocusStack/Petteri/3dpreview.h
HEADERS += FocusStack/Petteri/align.h
HEADERS += FocusStack/Petteri/background_removal.h
HEADERS += FocusStack/Petteri/denoise.h
HEADERS += FocusStack/Petteri/depthmap.h
HEADERS += FocusStack/Petteri/depthmap_inpaint.h
HEADERS += FocusStack/Petteri/fast_bilateral.h
HEADERS += FocusStack/Petteri/focusmeasure.h
HEADERS += FocusStack/Petteri/focusstack.h
HEADERS += FocusStack/Petteri/focusstackworker.h
HEADERS += FocusStack/Petteri/grayscale.h
HEADERS += FocusStack/Petteri/histogrampercentile.h
HEADERS += FocusStack/Petteri/loadimg.h
HEADERS += FocusStack/Petteri/logger.h
HEADERS += FocusStack/Petteri/merge.h
HEADERS += FocusStack/Petteri/options.h
HEADERS += FocusStack/Petteri/radialfilter.h
HEADERS += FocusStack/Petteri/reassign.h
HEADERS += FocusStack/Petteri/saveimg.h
HEADERS += FocusStack/Petteri/wavelet.h
HEADERS += FocusStack/Petteri/wavelet_opencl.h
HEADERS += FocusStack/Petteri/wavelet_templates.h
HEADERS += FocusStack/Petteri/worker.h
HEADERS += Image/autonomousimage.h
HEADERS += Image/imagealign.h
HEADERS += Image/pixmap.h
HEADERS += Image/stack.h
HEADERS += Image/thumb.h
#HEADERS += Image/tiffhandler.h
HEADERS += ImageFormats/Canon/canon.h
HEADERS += ImageFormats/Canon/canoncr3.h
HEADERS += ImageFormats/Dng/dng.h
HEADERS += ImageFormats/Fuji/fuji.h
#rgh remove heic
HEADERS += ImageFormats/Heic/heic.h
HEADERS += ImageFormats/Heic/heif.h
#HEADERS += ImageFormats/Heic/de265.h
#win32:HEADERS += ImageFormats/Heic/heic.h
#win32:HEADERS += ImageFormats/Heic/heif.h
win32:HEADERS += ImageFormats/Heic/de265.h
HEADERS += ImageFormats/Jpeg/jpeg.h
macx:HEADERS += ImageFormats/Jpeg/jpeg2.h
macx:HEADERS += ImageFormats/Jpeg/decoderJpg.h
macx:HEADERS += ImageFormats/Jpeg/jpgdecoder.h
macx:HEADERS += ImageFormats/jpeg/jpegturbo.h
HEADERS += ImageFormats/Nikon/nikon.h
HEADERS += ImageFormats/Olympus/olympus.h
HEADERS += ImageFormats/Panasonic/panasonic.h
HEADERS += ImageFormats/Sony/sony.h
HEADERS += ImageFormats/Tiff/tiff.h
macx:HEADERS += ImageFormats/Tiff/libtiff.h
HEADERS += ImageFormats/Tiff/rorytiff.h
HEADERS += ImageFormats/Base/rawbase.h
HEADERS += ImageFormats/Tiff/tiffdecoder.h
HEADERS += ImageStack/FocusStackConstants.h
HEADERS += ImageStack/stack_depth_map.h
HEADERS += ImageStack/focushalo.h
HEADERS += ImageStack/stack_focus_measure.h
HEADERS += ImageStack/focusstackutilities.h
HEADERS += ImageStack/focuswavelet.h
HEADERS += ImageStack/stackaligner.h
HEADERS += ImageStack/stackcontroller.h
HEADERS += ImageStack/stackfusion.h
HEADERS += Lcms2/lcms2.h
HEADERS += Lcms2/lcms2_plugin.h
HEADERS += Log/issue.h
HEADERS += Log/log.h
HEADERS += Main/dockwidget.h
HEADERS += Main/global.h
# HEADERS += Main/logger.h
HEADERS += Main/mainwindow.h
HEADERS += Main/qtlocalpeer.h
HEADERS += Main/qtlockedfile.h
HEADERS += Main/qtsingleapplication.h
HEADERS += Main/widgetcss.h
win32:HEADERS += Main/winnativeeventfilter.h
HEADERS += Metadata/exif.h
HEADERS += Metadata/exiftool.h
HEADERS += Metadata/irb.h
HEADERS += Metadata/gps.h
HEADERS += Metadata/ifd.h
HEADERS += Metadata/iptc.h
HEADERS += Metadata/imagemetadata.h
HEADERS += Metadata/metadata.h
HEADERS += Metadata/metareport.h
HEADERS += Metadata/rapidxml.h
HEADERS += Metadata/rapidxml_print_rgh.h
HEADERS += Metadata/xmp.h
#HEADERS += Metadata/ExifTool.h
#HEADERS += Metadata/ExifToolPipe.h
#HEADERS += Metadata/TagInfo.h
HEADERS += PropertyEditor/preferences.h
HEADERS += PropertyEditor/propertyeditor.h
HEADERS += PropertyEditor/propertydelegate.h
HEADERS += PropertyEditor/propertywidgets.h
HEADERS += Utilities/bit.h
HEADERS += Utilities/classificationlabel.h
HEADERS += Utilities/coloranalysis.h
HEADERS += Utilities/dirwatcher.h
HEADERS += Utilities/dropshadowlabel.h
HEADERS += Utilities/focuspointtrainer.h
HEADERS += Utilities/focuspredictor.h
HEADERS += Utilities/foldercompressor.h
HEADERS += Utilities/htmlwindow.h
HEADERS += Utilities/icc.h
macx:HEADERS += Utilities/mac.h
win32:HEADERS += Utilities/win.h
HEADERS += Utilities/inputdlg.h
HEADERS += Utilities/movingavg.h
HEADERS += Utilities/performance.h
HEADERS += Utilities/popup.h
HEADERS += Utilities/progressbar.h
HEADERS += Utilities/renamefile.h
HEADERS += Utilities/showhelp.h
HEADERS += Utilities/stresstest.h
HEADERS += Utilities/usbutil.h
HEADERS += Utilities/utilities.h
HEADERS += Views/compareImages.h
HEADERS += Views/compareview.h
HEADERS += Views/iconview.h
HEADERS += Views/iconviewdelegate.h
HEADERS += Views/imageview.h
HEADERS += Views/infostring.h
HEADERS += Views/infoview.h
HEADERS += Views/tableview.h
HEADERS += Views/videoview.h
HEADERS += Views/videowidget.h

SOURCES += Cache/cachedata.cpp \
    FocusStack/PetteriAdapter/petterialignfuse.cpp
SOURCES += Utilities/focuspointtrainer.cpp
SOURCES += Utilities/focuspredictor.cpp
SOURCES += Cache/tiffthumbdecoder.cpp
SOURCES += ImageFormats/Video/mov.cpp
SOURCES += ImageFormats/Video/mp4.cpp
SOURCES += ImageFormats/Png/png.cpp
SOURCES += Cache/framedecoder.cpp
SOURCES += Cache/imagecache.cpp
SOURCES += Cache/imagedecoder.cpp
SOURCES += Cache/metaread.cpp
SOURCES += Cache/reader.cpp
SOURCES += Datamodel/buildfilters.cpp
SOURCES += Datamodel/datamodel.cpp
SOURCES += Datamodel/filters.cpp
SOURCES += Datamodel/selection.cpp
SOURCES += Dialogs/aboutdlg.cpp
SOURCES += Dialogs/addthumbnailsdlg.cpp
SOURCES += Dialogs/appdlg.cpp
SOURCES += Dialogs/copystyledlg.cpp
SOURCES += Dialogs/editlistdlg.cpp
SOURCES += Dialogs/erasememcardimagesdlg.cpp
SOURCES += Dialogs/imagedlg.cpp
SOURCES += Dialogs/ingestdlg.cpp
SOURCES += Dialogs/ingesterrors.cpp
SOURCES += Dialogs/loadusbdlg.cpp
SOURCES += Dialogs/loupeinfodlg.cpp
SOURCES += Dialogs/managegraphicsdlg.cpp
SOURCES += Dialogs/manageimagesdlg.cpp
SOURCES += Dialogs/managetilesdlg.cpp
SOURCES += Dialogs/patterndlg.cpp
SOURCES += Dialogs/preferencesdlg.cpp
SOURCES += Dialogs/renamedlg.cpp
SOURCES += Dialogs/saveasdlg.cpp
SOURCES += Dialogs/selectionorpicksdlg.cpp
SOURCES += Dialogs/testaligndlg.cpp
SOURCES += Dialogs/tokendlg.cpp
SOURCES += Dialogs/updateapp.cpp
SOURCES += Dialogs/findduplicatesdlg.cpp
SOURCES += Dialogs/workspacedlg.cpp
SOURCES += Dialogs/zoomdlg.cpp
SOURCES += Effects/effects.cpp
SOURCES += Effects/graphicseffect.cpp
SOURCES += Effects/graphicsitemeventfilter.cpp
SOURCES += Embellish/embel.cpp
SOURCES += Embellish/Properties/embelproperties.cpp
SOURCES += Embellish/embelexport.cpp
SOURCES += File/bookmarks.cpp
SOURCES += File/fstree.cpp
SOURCES += File/hoverdelegate.cpp
SOURCES += File/ingest.cpp
SOURCES += FocusStack/generatefocusstack.cpp
SOURCES += FocusStack/Petteri/3dpreview.cpp
SOURCES += FocusStack/Petteri/align.cpp
SOURCES += FocusStack/Petteri/background_removal.cpp
SOURCES += FocusStack/Petteri/denoise.cpp
SOURCES += FocusStack/Petteri/depthmap.cpp
SOURCES += FocusStack/Petteri/depthmap_inpaint.cpp
SOURCES += FocusStack/Petteri/focusmeasure.cpp
SOURCES += FocusStack/Petteri/focusstack.cpp
SOURCES += FocusStack/Petteri/focusstackworker.cpp
SOURCES += FocusStack/Petteri/grayscale.cpp
SOURCES += FocusStack/Petteri/histogrampercentile.cpp
SOURCES += FocusStack/Petteri/loadimg.cpp
SOURCES += FocusStack/Petteri/logger.cpp
SOURCES += FocusStack/Petteri/merge.cpp
SOURCES += FocusStack/Petteri/options.cpp
SOURCES += FocusStack/Petteri/radialfilter.cpp
SOURCES += FocusStack/Petteri/reassign.cpp
SOURCES += FocusStack/Petteri/saveimg.cpp
SOURCES += FocusStack/Petteri/wavelet.cpp
SOURCES += FocusStack/Petteri/wavelet_opencl.cpp
SOURCES += FocusStack/Petteri/worker.cpp
SOURCES += FocusStack/Fusion/fusionbase.cpp
SOURCES += FocusStack/Fusion/fusionfactory.cpp
SOURCES += FocusStack/Fusion/fusionpmaxbasic.cpp
SOURCES += FocusStack/Fusion/fusionwavepmax.cpp
SOURCES += FocusStack/Mask/maskassessor.cpp
SOURCES += FocusStack/Mask/maskgenerator.cpp
SOURCES += FocusStack/Mask/maskrefiner.cpp
SOURCES += FocusStack/PetteriAdapter/petterialign.cpp
SOURCES += FocusStack/PetteriAdapter/petteridepthmap.cpp
SOURCES += FocusStack/PetteriAdapter/petterifocusmaps.cpp
SOURCES += FocusStack/PetteriAdapter/petteripipeline.cpp
SOURCES += FocusStack/PetteriAdapter/petteripmaxfusion.cpp
SOURCES += Image/autonomousimage.cpp
SOURCES += Image/imagealign.cpp
SOURCES += Image/pixmap.cpp
SOURCES += Image/stack.cpp
SOURCES += Image/thumb.cpp
#SOURCES += Image/tiffhandler.cpp
SOURCES += ImageFormats/Canon/canon.cpp
SOURCES += ImageFormats/Canon/canoncr3.cpp
SOURCES += ImageFormats/Dng/dng.cpp
SOURCES += ImageFormats/Fuji/fuji.cpp
SOURCES += ImageFormats/Heic/Heic.cpp
#win32:SOURCES += ImageFormats/Heic/Heic.cpp
SOURCES += ImageFormats/Jpeg/jpeg.cpp               # For parsing
macx:SOURCES += ImageFormats/Jpeg/jpeg2.cpp         # Copy jpeg.h for experimenting
macx:SOURCES += ImageFormats/Jpeg/jpgdecoder.cpp    # JED project (Jpeg Encoder Decoder)
macx:SOURCES += ImageFormats/Jpeg/jpegturbo.cpp     # libjpeg-turbo
SOURCES += ImageFormats/Nikon/nikon.cpp
SOURCES += ImageFormats/Olympus/olympus.cpp
SOURCES += ImageFormats/Panasonic/panasonic.cpp
SOURCES += ImageFormats/Sony/sony.cpp
SOURCES += ImageFormats/Tiff/tiff.cpp               # For parsing
macx:SOURCES += ImageFormats/Tiff/libtiff.cpp       # use library directly
SOURCES += ImageFormats/Tiff/rorytiff.cpp           # Rory decoder
SOURCES += ImageFormats/Base/rawbase.cpp
SOURCES += ImageFormats/Tiff/tiffdecoder.cpp
SOURCES += ImageStack/stack_depth_map.cpp
SOURCES += ImageStack/focushalo.cpp
SOURCES += ImageStack/stack_focus_measure.cpp
SOURCES += ImageStack/focusstackutilities.cpp
SOURCES += ImageStack/focuswavelet.cpp
SOURCES += ImageStack/stackaligner.cpp
SOURCES += ImageStack/stackcontroller.cpp
SOURCES += ImageStack/stackfusion.cpp
SOURCES += Lcms2/cmsalpha.c
SOURCES += Lcms2/cmscam02.c
SOURCES += Lcms2/cmscgats.c
SOURCES += Lcms2/cmscnvrt.c
SOURCES += Lcms2/cmserr.c
SOURCES += Lcms2/cmsgamma.c
SOURCES += Lcms2/cmsgmt.c
SOURCES += Lcms2/cmshalf.c
SOURCES += Lcms2/cmsintrp.c
SOURCES += Lcms2/cmsio0.c
SOURCES += Lcms2/cmsio1.c
SOURCES += Lcms2/cmslut.c
SOURCES += Lcms2/cmsmd5.c
SOURCES += Lcms2/cmsmtrx.c
SOURCES += Lcms2/cmsnamed.c
SOURCES += Lcms2/cmsopt.c
SOURCES += Lcms2/cmspack.c
SOURCES += Lcms2/cmspcs.c
SOURCES += Lcms2/cmsplugin.c
SOURCES += Lcms2/cmsps2.c
SOURCES += Lcms2/cmssamp.c
SOURCES += Lcms2/cmssm.c
SOURCES += Lcms2/cmstypes.c
SOURCES += Lcms2/cmsvirt.c
SOURCES += Lcms2/cmswtpnt.c
SOURCES += Lcms2/cmsxform.c
SOURCES += Log/issue.cpp
SOURCES += Log/log.cpp
SOURCES += Main/main.cpp
# all part of MW (mainwindow)
SOURCES += Main/mainwindow.cpp
SOURCES += Main/diagnostics.cpp
SOURCES += Main/draganddrop.cpp
SOURCES += Main/externalapp.cpp
SOURCES += Main/fileoperations.cpp
SOURCES += Main/initialize.cpp
# SOURCES += Main/log.cpp
# SOURCES += Main/logger.cpp
SOURCES += Main/menusandactions.cpp
SOURCES += Main/navigate.cpp
SOURCES += Main/pick.cpp
SOURCES += Main/setandupdate.cpp
SOURCES += Main/settings.cpp
SOURCES += Main/slideshow.cpp
SOURCES += Main/sortandfilter.cpp
SOURCES += Main/status.cpp
SOURCES += Main/test.cpp
SOURCES += Main/viewmodes.cpp
win32:SOURCES += Main/winnativeeventfilter.cpp
SOURCES += Main/workspaces.cpp
SOURCES += Main/dockwidget.cpp
SOURCES += Main/global.cpp
SOURCES += Main/qtlocalpeer.cpp
SOURCES += Main/qtlockedfile.cpp
macx:SOURCES += Main/qtlockedfile_unix.cpp
win32:SOURCES += Main/qtlockedfile_win.cpp
SOURCES += Main/qtsingleapplication.cpp
SOURCES += Main/widgetcss.cpp
SOURCES += Metadata/exif.cpp
SOURCES += Metadata/exiftool.cpp
SOURCES += Metadata/irb.cpp
SOURCES += Metadata/gps.cpp
SOURCES += Metadata/ifd.cpp
SOURCES += Metadata/iptc.cpp
SOURCES += Metadata/metadata.cpp
SOURCES += Metadata/metareport.cpp
SOURCES += Metadata/xmp.cpp
#SOURCES += Metadata/ExifTool.cpp
#SOURCES += Metadata/ExifToolPipe.cpp
#SOURCES += Metadata/TagInfo.cpp
SOURCES += PropertyEditor/preferences.cpp
SOURCES += PropertyEditor/propertyeditor.cpp
SOURCES += PropertyEditor/propertydelegate.cpp
SOURCES += PropertyEditor/propertywidgets.cpp
SOURCES += Utilities/bit.cpp
SOURCES += Utilities/classificationlabel.cpp
SOURCES += Utilities/coloranalysis.cpp
SOURCES += Utilities/dirwatcher.cpp
SOURCES += Utilities/dropshadowlabel.cpp
SOURCES += Utilities/foldercompressor.cpp
SOURCES += Utilities/htmlwindow.cpp
SOURCES += Utilities/icc.cpp
SOURCES += Utilities/inputdlg.cpp
macx:SOURCES += Utilities/mac.mm
SOURCES += Utilities/performance.cpp
SOURCES += Utilities/popup.cpp
SOURCES += Utilities/progressbar.cpp
SOURCES += Utilities/renamefile.cpp
SOURCES += Utilities/showhelp.cpp
SOURCES += Utilities/stresstest.cpp
SOURCES += Utilities/usbutil.cpp
SOURCES += Utilities/utilities.cpp
win32:SOURCES += Utilities/win.cpp
SOURCES += Views/compareImages.cpp
SOURCES += Views/compareview.cpp
SOURCES += Views/iconview.cpp
SOURCES += Views/iconviewdelegate.cpp
SOURCES += Views/imageview.cpp
SOURCES += Views/infoview.cpp
SOURCES += Views/tableview.cpp
SOURCES += Views/infostring.cpp
SOURCES += Views/videoview.cpp
SOURCES += Views/videowidget.cpp

FORMS += Dialogs/aboutdlg.ui
FORMS += Dialogs/loupeinfodlg.ui
FORMS += Dialogs/addthumbnailsdlg.ui
FORMS += Dialogs/aligndlg.ui
FORMS += Dialogs/appdlg.ui
FORMS += Dialogs/copystyledlg.ui
FORMS += Dialogs/editlistdlg.ui
FORMS += Dialogs/erasememcardimagesdlg.ui
FORMS += Dialogs/findduplicatesdlg.ui
FORMS += Dialogs/imagedlg.ui
FORMS += Dialogs/ingestdlg.ui
FORMS += Dialogs/ingesterrors.ui
FORMS += Dialogs/loadusbdlg.ui
FORMS += Dialogs/managegraphicsdlg.ui
FORMS += Dialogs/manageimagesdlg.ui
FORMS += Dialogs/managetilesdlg.ui
FORMS += Dialogs/patterndlg.ui
FORMS += Dialogs/renamedlg.ui
FORMS += Dialogs/renamefiledlg.ui
FORMS += Dialogs/saveasdlg.ui
FORMS += Dialogs/selectionorpicksdlg.ui
FORMS += Dialogs/testaligndlg.ui
FORMS += Dialogs/testdlg.ui
FORMS += Dialogs/test1.ui
FORMS += Dialogs/test12.ui
FORMS += Dialogs/tokendlg.ui
FORMS += Dialogs/updateapp.ui
FORMS += Dialogs/workspacedlg.ui
FORMS += Dialogs/zoomdlg.ui
FORMS += Embellish/embelCoord.ui
FORMS += Help/filtershelp.ui
FORMS += Help/foldershelp.ui
FORMS += Help/helpfindduplicates.ui
FORMS += Help/helpform.ui
FORMS += Help/helpingest.ui
FORMS += Help/helppixeldelta.ui
FORMS += Help/ingestautopath.ui
FORMS += Help/introduction.ui
FORMS += Help/message.ui
FORMS += Help/shortcutsform.ui
FORMS += Help/welcome.ui
FORMS += Metadata/metadatareport.ui
FORMS += Utilities/inputdlg.ui

RESOURCES += winnow.qrc
ICON = images/winnow.icns
RC_ICONS = images/winnow.ico

DISTFILES += $$files(Lib/*, true) \
    FocusStack/Petteri/wavelet_opencl_kernels.cl
DISTFILES += notes/Documentation.txt
DISTFILES += Docs/ingestautopath
DISTFILES += notes/InstallMediaPipe.txt
DISTFILES += CMakeLists.txt
DISTFILES += _CMakeLists.txt
DISTFILES += notes/_InstallLibrary.txt
DISTFILES += notes/_install library.txt
DISTFILES += notes/_install library.txt
DISTFILES += notes/_install library.txt
DISTFILES += notes/_install library.txt
DISTFILES += notes/Create help dialog.rtf
DISTFILES += notes/Create help dialog.txt
DISTFILES += Docs/ingestautopath.html
DISTFILES += Docs/versions
DISTFILES += Docs/test.html
DISTFILES += notes/_Symbols
DISTFILES += notes/_Notes
DISTFILES += notes/_ToDo.txt
DISTFILES += notes/DeployInstall.txt
DISTFILES += notes/ExiftoolCommands.txt
DISTFILES += notes/git.txt
DISTFILES += notes/help_videos_on_mac.txt
DISTFILES += notes/HelpDocCreation.txt
DISTFILES += notes/HelpVideoNotes.txt
DISTFILES += notes/hevcinfo
DISTFILES += notes/ImageMagick
DISTFILES += notes/Menu.txt
DISTFILES += notes/Object_detection
DISTFILES += notes/scratch.css
DISTFILES += notes/scratch.html
DISTFILES += notes/Scratch.txt
DISTFILES += notes/Scratch2.txt
DISTFILES += notes/Shortcuts.txt
DISTFILES += notes/snippets.txt
DISTFILES += notes/users.txt
DISTFILES += notes/VideoScripts
DISTFILES += notes/xmp.txt

# *** MAC Libraries ***
macx {
    LIBS += -framework ApplicationServices
    LIBS += -framework AppKit
    LIBS += -framework CoreFoundation
    LIBS += -framework Foundation

    # opencv
    LIBS += -L/opt/homebrew/lib
    LIBS += -lopencv_core.411
    LIBS += -lopencv_imgproc.411
    LIBS += -lopencv_imgcodecs
    LIBS += -lopencv_video
    LIBS += -lopencv_dnn.411
    INCLUDEPATH += /opt/homebrew/opt/opencv/include/opencv4

    # libtiff
    LIBS += -L/opt/homebrew/opt/libtiff/lib -ltiff
    INCLUDEPATH += /opt/homebrew/opt/libtiff/include

    # libjpeg-turbo
    LIBS += -L/opt/homebrew/opt/jpeg-turbo/lib -lturbojpeg
    INCLUDEPATH += /opt/homebrew/opt/jpeg-turbo/include

    # zLib
    LIBS += -lz
    INCLUDEPATH += /usr/include

    # ExifTool folder (recursive)
    QMAKE_BUNDLE_DATA += exiftool_data
    exiftool_data.files = $$files($$PWD/ReleaseExtras/ExifTool, true)
    exiftool_data.path  = Contents/MacOS

    # Winnets folder (recursive)
    QMAKE_BUNDLE_DATA += winnets_data
    winnets_data.files = $$files($$PWD/ReleaseExtras/Winnets, true)
    winnets_data.path  = Contents/MacOS

    # ONNX model file
    QMAKE_BUNDLE_DATA += model_data
    model_data.files = $$PWD/ReleaseExtras/focus_point_model.onnx
    model_data.path  = Contents/MacOS
}

# *** WIN Libraries ***
win32 {
    CONFIG(debug, debug|release) {
        message(" Debug build - using debug libraries")

        # --- OpenCV (single combined lib build) ---
        LIBS += -L$$PWD/Lib/opencv/windows/build/x64/vc16/lib -lopencv_world4110
        INCLUDEPATH += $$PWD/Lib/opencv/windows/build/include

        # --- libde265 (frame parallel) ---
        LIBS += -L$$PWD/Lib/libde265/debug -llibde265
        INCLUDEPATH += $$PWD/Lib/libde265/include
        DEPENDPATH  += $$PWD/Lib/libde265/debug

        # --- zLib ---
        LIBS += -L$$PWD/Lib/zlib/build/Debug -lzlib
        INCLUDEPATH += $$PWD/Lib/zlib
        INCLUDEPATH += $$PWD/Lib/zlib/build
        DEPENDPATH  += $$PWD/Lib/zlib/build/Debug

        # --- libheif ---
        LIBS += -L$$PWD/Lib/libheif/debug -llibheif
        INCLUDEPATH += $$PWD/Lib/libheif/include
        DEPENDPATH  += $$PWD/Lib/libheif/debug

        # --- libtiff ---
        LIBS += -L$$PWD/Lib/libtiff/build/libtiff/Debug -ltiff
        INCLUDEPATH += $$PWD/Lib/libtiff/libtiff
        INCLUDEPATH += $$PWD/Lib/libtiff/build/libtiff
        DEPENDPATH  += $$PWD/Lib/libtiff/build/libtiff/Debug

    } else {
        message(" Release build - using release libraries")

        # --- OpenCV (single combined lib build) ---
        LIBS += -L$$PWD/Lib/opencv/windows/build/x64/vc16/lib -lopencv_world4110
        INCLUDEPATH += $$PWD/Lib/opencv/windows/build/include

        # --- libde265 (frame parallel) ---
        LIBS += -L$$PWD/Lib/libde265/release -llibde265
        INCLUDEPATH += $$PWD/Lib/libde265/include
        DEPENDPATH  += $$PWD/Lib/libde265/release

        # --- zLib ---
        LIBS += -L$$PWD/Lib/zlib/build/Release -lzlib
        INCLUDEPATH += $$PWD/Lib/zlib
        INCLUDEPATH += $$PWD/Lib/zlib/build
        DEPENDPATH  += $$PWD/Lib/zlib/build/Release

        # --- libheif ---
        LIBS += -L$$PWD/Lib/libheif/release -llibheif
        INCLUDEPATH += $$PWD/Lib/libheif/include
        DEPENDPATH  += $$PWD/Lib/libheif/release

        # --- libtiff ---
        LIBS += -L$$PWD/Lib/libtiff/build/libtiff/Release -ltiff
        INCLUDEPATH += $$PWD/Lib/libtiff/libtiff
        INCLUDEPATH += $$PWD/Lib/libtiff/build/libtiff
        DEPENDPATH  += $$PWD/Lib/libtiff/build/libtiff/Release
    }
}





preferences.cpp:2:10: In included file: 'ui_metadatareport.h' file not found
metadata.h:23:10: error occurred here





































































